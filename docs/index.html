<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VarsityVive - Campus Social Network</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Add these in the head section -->
<script src="https://cdn.jsdelivr.net/npm/sockjs-client@1.5.1/dist/sockjs.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/stomp-websocket@2.3.4/lib/stomp.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #7e22ce;
      --primary-light: #a855f7;
      --secondary: #f43f5e;
      --accent: #0ea5e9;
      --dark: #1e293b;
      --light: #386b9e;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #f0f9ff 0%, #fdf2f8 100%);
      color: var(--dark);
    }
    
    .gradient-bg {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
    }
    
    .post-card {
      transition: all 0.3s ease;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
      background: white;
      border-radius: 16px;
      overflow: hidden;
    }
    
    .post-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
    }
    
    .notification-badge {
      position: absolute;
      top: -5px;
      right: -5px;
      width: 20px;
      height: 20px;
      background-color: var(--secondary);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      color: white;
      animation: pulse 1.5s infinite;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
      color: white;
      transition: all 0.3s ease;
      border: none;
      font-weight: 600;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 10px rgba(126, 34, 206, 0.3);
    }
    
    .smooth-scroll {
      scroll-behavior: smooth;
    }
    
    .profile-cover {
      height: 250px;
      background: linear-gradient(to right, #4f46e5, #7c3aed);
    }
    
    .card-shadow {
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    }
    
    .glass-effect {
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.18);
      border-radius: 16px;
    }
    
    .vibrant-card {
      background: linear-gradient(145deg, #ffffff, #f0f0f0);
      border-radius: 16px;
      box-shadow: 0 8px 20px rgba(126, 34, 206, 0.15);
      transition: all 0.3s ease;
      overflow: hidden;
    }
    
    .vibrant-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 25px rgba(126, 34, 206, 0.25);
    }
    
    .gradient-text {
      background: linear-gradient(135deg, var(--primary), var(--accent));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .floating {
      animation: float 6s ease-in-out infinite;
    }
    
    @keyframes float {
      0% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
      100% { transform: translateY(0px); }
    }
    
    @keyframes pulse {
      0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(244, 63, 94, 0.7); }
      70% { transform: scale(1.05); box-shadow: 0 0 0 10px rgba(244, 63, 94, 0); }
      100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(244, 63, 94, 0); }
    }
    
    .fade-in {
      animation: fadeIn 0.5s ease-in;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .header-gradient {
      background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
      color: white;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    
    .btn-secondary {
      background: linear-gradient(135deg, var(--accent) 0%, #38bdf8 100%);
      color: white;
      transition: all 0.3s ease;
    }
    
    .btn-secondary:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 10px rgba(14, 165, 233, 0.3);
    }
    
    .btn-tertiary {
      background: linear-gradient(135deg, var(--secondary) 0%, #fb7185 100%);
      color: white;
      transition: all 0.3s ease;
    }
    
    .btn-tertiary:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 10px rgba(244, 63, 94, 0.3);
    }
    
    .chat-container {
      height: calc(100vh - 150px);
    }
    
    .message-bubble {
      max-width: 70%;
      border-radius: 18px;
      padding: 12px 16px;
      margin-bottom: 8px;
      position: relative;
    }
    
    .message-bubble.sent {
      background: var(--primary-light);
      color: white;
      align-self: flex-end;
      border-bottom-right-radius: 4px;
    }
    
    .message-bubble.received {
      background: #f1f5f9;
      align-self: flex-start;
      border-bottom-left-radius: 4px;
    }
    
    .online-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: #10b981;
      position: absolute;
      bottom: 0;
      right: 0;
      border: 2px solid white;
    }
    
    /* New styles for enhanced sections */
    .sports-card {
      background: linear-gradient(145deg, #f0fdf4, #f7fee7);
      border-left: 4px solid #16a34a;
    }
    
    .blood-card {
      background: linear-gradient(145deg, #fff1f2, #fff7f9);
      border-left: 4px solid #e11d48;
    }
    
    .club-card {
      background: linear-gradient(145deg, #f0f9ff, #f5fbff);
      border-left: 4px solid #0ea5e9;
    }
    
    .notification-card {
      background: linear-gradient(145deg, #fdf2f8, #fdf4fb);
      border-left: 4px solid #ec4899;
    }
    
    .floating-card {
      animation: float 6s ease-in-out infinite;
    }
    
    .pulse {
      animation: pulse 2s infinite;
    }
    
    .sports-icon {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      background: linear-gradient(135deg, #16a34a, #22c55e);
      color: white;
    }
    
    .blood-icon {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      background: linear-gradient(135deg, #e11d48, #f43f5e);
      color: white;
    }
    
    .club-icon {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      background: linear-gradient(135deg, #0ea5e9, #38bdf8);
      color: white;
    }
    
    .stat-badge {
      background: rgba(126, 34, 206, 0.1);
      color: #7e22ce;
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 0.85rem;
    }
    
    .event-card {
      background: linear-gradient(145deg, #fdf2f8, #fce7f3);
      border-radius: 12px;
    }
    
    .chat-header {
      background: linear-gradient(135deg, #7e22ce, #0ea5e9);
    }
    
    .tournament-card {
      background: linear-gradient(145deg, #fffbeb, #fef3c7);
      border-left: 4px solid #f59e0b;
    }

    /* Chat button styles */
    .chat-btn {
      background: linear-gradient(135deg, var(--accent) 0%, #38bdf8 100%);
      color: white;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 0.85rem;
      display: inline-flex;
      align-items: center;
      transition: all 0.2s ease;
    }
    
    .chat-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 6px rgba(14, 165, 233, 0.2);
    }
    
    .chat-btn i {
      margin-right: 4px;
    }
    /* All previous CSS styles remain the same */
    /* New chat-specific styles */
    .typing-indicator {
      display: flex;
      align-items: center;
      padding: 8px 12px;
    }
    
    .typing-indicator span {
      width: 8px;
      height: 8px;
      background-color: #7e22ce;
      border-radius: 50%;
      display: inline-block;
      margin: 0 2px;
      animation: typing 1s infinite;
    }
    
    .typing-indicator span:nth-child(2) {
      animation-delay: 0.2s;
    }
    
    .typing-indicator span:nth-child(3) {
      animation-delay: 0.4s;
    }
    
    @keyframes typing {
      0%, 60%, 100% { transform: translateY(0); }
      30% { transform: translateY(-5px); }
    }
    
    .chat-preview {
      transition: all 0.2s ease;
      cursor: pointer;
      padding: 10px;
      border-radius: 10px;
    }
    
    .chat-preview:hover {
      background-color: rgba(126, 34, 206, 0.05);
    }
    
    .unread-count {
      background-color: #0ea5e9;
      color: white;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
    }
    
    .message-container {
      display: flex;
      margin-bottom: 12px;
    }
    
    .message-container.sent {
      justify-content: flex-end;
    }
    
    .message-container.received {
      justify-content: flex-start;
    }
    
    .chat-timestamp {
      font-size: 0.7rem;
      color: #6b7280;
      margin-top: 4px;
      text-align: right;
    }

    
    /* Enhanced Chat Styles */
    .chat-container {
      height: calc(100vh - 150px);
      display: flex;
      flex-direction: column;
    }
    
    .message-bubble {
      max-width: 70%;
      border-radius: 18px;
      padding: 12px 16px;
      margin-bottom: 8px;
      position: relative;
      word-wrap: break-word;
    }
    
    .message-bubble.sent {
      background: var(--primary-light);
      color: white;
      align-self: flex-end;
      border-bottom-right-radius: 4px;
    }
    
    .message-bubble.received {
      background: #f1f5f9;
      align-self: flex-start;
      border-bottom-left-radius: 4px;
    }
    
    .online-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: #10b981;
      position: absolute;
      bottom: 0;
      right: 0;
      border: 2px solid white;
    }
    
    .typing-indicator {
      display: flex;
      align-items: center;
      padding: 8px 12px;
    }
    
    .typing-indicator span {
      width: 8px;
      height: 8px;
      background-color: #7e22ce;
      border-radius: 50%;
      display: inline-block;
      margin: 0 2px;
      animation: typing 1s infinite;
    }
    
    .typing-indicator span:nth-child(2) {
      animation-delay: 0.2s;
    }
    
    .typing-indicator span:nth-child(3) {
      animation-delay: 0.4s;
    }
    
    @keyframes typing {
      0%, 60%, 100% { transform: translateY(0); }
      30% { transform: translateY(-5px); }
    }
    
    .chat-header {
      background: linear-gradient(135deg, var(--primary), var(--accent));
      color: white;
      padding: 12px 0;
      position: sticky;
      top: 0;
      z-index: 10;
    }
  </style>
</head>
<body class="smooth-scroll">
  <div id="root"></div>

  <script type="text/babel">

// --- API base helper (works from file:// or any port) ---
const API_BASE = (function () {
  try { if (location.origin && location.origin.startsWith('http')) return location.origin; } catch (e) {}
  return 'http://localhost:5000';
})();

    // ======================
    // Database Simulation
    // ======================
    class Database {
      constructor() {
        this.initDatabase();
      }
      
      initDatabase() {
        if (!localStorage.getItem('vv_users')) {
          localStorage.setItem('vv_users', JSON.stringify([
            {
              id: 1,
              name: "John Doe",
              email: "john@varsity.edu",
              password: "password123",
              department: "Computer Science",
              batch: "2023",
              section: "A",
              profilePic: "https://randomuser.me/api/portraits/men/1.jpg",
              coverPic: "https://images.unsplash.com/photo-1497366754035-f200968a6e72?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1000&q=80",
              bio: "CS Student | Web Developer",
              friends: [2, 3],
              universityId: "STU001",
              universityEmail: "john@univ.edu",
              bloodGroup: "A+"
            },
            {
              id: 2,
              name: "Jane Smith",
              email: "jane@varsity.edu",
              password: "password123",
              department: "Electrical Engineering",
              batch: "2022",
              section: "B",
              profilePic: "https://randomuser.me/api/portraits/women/1.jpg",
              coverPic: "https://images.unsplash.com/photo-1503676260728-1c00da094a0b?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1000&q=80",
              bio: "EE Student | Robotics Enthusiast",
              friends: [1, 3],
              universityId: "STU002",
              universityEmail: "jane@univ.edu",
              bloodGroup: "B+"
            },
            {
              id: 3,
              name: "Alex Chen",
              email: "alex@varsity.edu",
              password: "password123",
              department: "Mechanical Engineering",
              batch: "2024",
              section: "C",
              profilePic: "https://randomuser.me/api/portraits/men/2.jpg",
              coverPic: "https://images.unsplash.com/photo-1541339907198-e08756dedf3f?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1000&q=80",
              bio: "Car enthusiast and F1 fan",
              friends: [2],
              universityId: "STU003",
              universityEmail: "alex@univ.edu",
              bloodGroup: "O+"
            },
            {
              id: 4,
              name: "Sarah Johnson",
              email: "sarah@varsity.edu",
              password: "password123",
              department: "Sports Science",
              batch: "2023",
              section: "B",
              profilePic: "https://randomuser.me/api/portraits/women/2.jpg",
              coverPic: "https://images.unsplash.com/photo-1541339907198-e08756dedf3f?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1000&q=80",
              bio: "Basketball team captain",
              friends: [1],
              universityId: "STU004",
              universityEmail: "sarah@univ.edu",
              bloodGroup: "AB+"
            }
          ]));
        }

        if (!localStorage.getItem('vv_posts')) {
          localStorage.setItem('vv_posts', JSON.stringify([
            {
              id: 1,
              userId: 1,
              content: "Just finished my final project for CS101! It was challenging but I learned so much about React and Node.js.",
              media: "https://images.unsplash.com/photo-1555066931-4365d14bab8c?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=600&q=80",
              mediaType: "image",
              likes: [2, 3],
              comments: [
                { id: 1, userId: 2, text: "Great job! The UI looks amazing.", timestamp: "2023-05-15T11:30:00Z" },
                { id: 2, userId: 3, text: "Impressive work! Can you share the GitHub repo?", timestamp: "2023-05-15T12:45:00Z" }
              ],
              shares: [],
              timestamp: "2023-05-15T10:30:00Z",
              category: "GENERAL"
            },
            {
              id: 2,
              userId: 2,
              content: "Anyone interested in joining robotics club? We're meeting this Friday at 3 PM in the engineering building.",
              media: null,
              mediaType: null,
              likes: [1, 3],
              comments: [
                { id: 1, userId: 1, text: "I'm interested! I'll definitely come.", timestamp: "2023-05-14T16:45:00Z" }
              ],
              shares: [3],
              timestamp: "2023-05-14T15:45:00Z",
              category: "CLUB"
            },
            {
              id: 3,
              userId: 3,
              content: "Just attended an amazing workshop on machine learning. The future is AI!",
              media: "https://images.unsplash.com/photo-1677442135722-5f5d4aae1d77?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=600&q=80",
              mediaType: "image",
              likes: [1, 2],
              comments: [],
              shares: [1],
              timestamp: "2023-05-16T09:15:00Z",
              category: "GENERAL"
            },
            {
              id: 4,
              userId: 1,
              content: "Our basketball team won the inter-college tournament! ðŸ† So proud of everyone!",
              media: "https://images.unsplash.com/photo-1546519638-68e109498ffc?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=600&q=80",
              mediaType: "image",
              likes: [2, 3],
              comments: [],
              shares: [],
              timestamp: "2023-05-18T14:20:00Z",
              category: "SPORTS"
            },
            {
              id: 5,
              userId: 4,
              content: "Basketball tryouts next week! Show up if you're interested in joining the team.",
              media: "https://images.unsplash.com/photo-1546519638-68e109498ffc?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=600&q=80",
              mediaType: "image",
              likes: [1, 2, 3],
              comments: [
                { id: 1, userId: 1, text: "What time are the tryouts?", timestamp: "2023-05-19T10:15:00Z" }
              ],
              shares: [],
              timestamp: "2023-05-19T09:30:00Z",
              category: "SPORTS"
            },
            {
              id: 6,
              userId: 3,
              content: "Looking for O+ blood donors. Urgent requirement at the medical center. Please contact if you can help!",
              media: null,
              mediaType: null,
              likes: [1, 2],
              comments: [
                { id: 1, userId: 2, text: "I'm O+, I can help. Where should I come?", timestamp: "2023-05-19T10:15:00Z" }
              ],
              shares: [1],
              timestamp: "2023-05-19T09:30:00Z",
              category: "BLOOD"
            }
          ]));
        }

        if (!localStorage.getItem('vv_notifications')) {
          localStorage.setItem('vv_notifications', JSON.stringify([
            {
              id: 1,
              userId: 1,
              type: 'friend_request',
              fromUserId: 3,
              message: 'Alex Chen sent you a friend request',
              read: false,
              timestamp: "2023-05-20T09:15:00Z"
            },
            {
              id: 2,
              userId: 1,
              type: 'like',
              fromUserId: 2,
              postId: 1,
              message: 'Jane Smith liked your post',
              read: false,
              timestamp: "2023-05-19T14:30:00Z"
            },
            {
              id: 3,
              userId: 1,
              type: 'comment',
              fromUserId: 3,
              postId: 1,
              message: 'Alex Chen commented on your post',
              read: false,
              timestamp: "2023-05-19T15:45:00Z"
            }
          ]));
        }

        if (!localStorage.getItem('vv_clubs')) {
          localStorage.setItem('vv_clubs', JSON.stringify([
            {
              id: 1,
              name: "Robotics Club",
              description: "For robotics enthusiasts. We build robots, compete in competitions, and learn together.",
              members: [1, 2, 3],
              events: [
                {
                  id: 1,
                  title: "Robotics Workshop",
                  date: "2023-06-10T14:00:00Z",
                  location: "Tech Building Room 302"
                }
              ]
            },
            {
              id: 2,
              name: "Debate Society",
              description: "Sharpen your public speaking skills and engage in intellectual discussions.",
              members: [2],
              events: [
                {
                  id: 1,
                  title: "Inter-department Debate",
                  date: "2023-06-15T16:00:00Z",
                  location: "Main Auditorium"
                }
              ]
            },
            {
              id: 3,
              name: "Photography Club",
              description: "Capture campus life and beyond. All skill levels welcome!",
              members: [1, 3],
              events: [
                {
                  id: 1,
                  title: "Campus Photo Walk",
                  date: "2023-06-05T10:00:00Z",
                  location: "Main Quad"
                }
              ]
            }
          ]));
        }
        
        if (!localStorage.getItem('vv_tournaments')) {
          localStorage.setItem('vv_tournaments', JSON.stringify([
            {
              id: 1,
              title: "Inter-University Cricket Championship",
              description: "Annual cricket tournament between universities. Register your team now!",
              date: "2023-06-25T09:00:00Z",
              location: "University Cricket Ground",
              organizerId: 1,
              participants: [2, 3],
              sport: "Cricket"
            },
            {
              id: 2,
              title: "Basketball League Finals",
              description: "Finals of the campus basketball league. Come support your department!",
              date: "2023-07-10T17:00:00Z",
              location: "Sports Complex Court 1",
              organizerId: 4,
              participants: [1, 3],
              sport: "Basketball"
            }
          ]));
        }
      }
      
      getUsers() {
        return JSON.parse(localStorage.getItem('vv_users')) || [];
      }
      
      getPosts() {
        return JSON.parse(localStorage.getItem('vv_posts')) || [];
      }
      
      getNotifications() {
        return JSON.parse(localStorage.getItem('vv_notifications')) || [];
      }
      
      getClubs() {
        return JSON.parse(localStorage.getItem('vv_clubs')) || [];
      }
      
      getTournaments() {
        return JSON.parse(localStorage.getItem('vv_tournaments')) || [];
      }
      
      saveUsers(users) {
        localStorage.setItem('vv_users', JSON.stringify(users));
      }
      
      savePosts(posts) {
        localStorage.setItem('vv_posts', JSON.stringify(posts));
      }
      
      saveNotifications(notifications) {
        localStorage.setItem('vv_notifications', JSON.stringify(notifications));
      }
      
      saveClubs(clubs) {
        localStorage.setItem('vv_clubs', JSON.stringify(clubs));
      }
      
      saveTournaments(tournaments) {
        localStorage.setItem('vv_tournaments', JSON.stringify(tournaments));
      }
    }
    
    const db = new Database();
    
    // ======================
    // Main App Component
    // ======================
    function App() {
      const [currentUser, setCurrentUser] = React.useState(() => {
  try { return JSON.parse(localStorage.getItem('vv_user') || 'null'); } catch (e) { return null; }
});
      const [view, setView] = React.useState('home');
      const [users, setUsers] = React.useState(db.getUsers());
      const [posts, setPosts] = React.useState(db.getPosts());
      const [notifications, setNotifications] = React.useState(db.getNotifications());

// Keep current user in localStorage so refresh keeps you logged in
React.useEffect(() => {
  try {
    if (currentUser) {
      localStorage.setItem('vv_user', JSON.stringify(currentUser));
    }
  } catch (e) {}
}, [currentUser]);

      const [clubs, setClubs] = React.useState(db.getClubs());
      const [tournaments, setTournaments] = React.useState(db.getTournaments());
      const [searchTerm, setSearchTerm] = React.useState('');
      const [showNotifications, setShowNotifications] = React.useState(false);
      const [viewingProfileId, setViewingProfileId] = React.useState(null);
      const [viewingClubId, setViewingClubId] = React.useState(null);
      const [chattingWith, setChattingWith] = React.useState(null);
      const [messages, setMessages] = React.useState([]);
      const [newMessage, setNewMessage] = React.useState('');
      const [isTyping, setIsTyping] = React.useState(false);
      const [stompClient, setStompClient] = React.useState(null);
      
      // Filter posts and users based on search term
      const filteredPosts = posts.filter(post => 
        post.content.toLowerCase().includes(searchTerm.toLowerCase()) ||
        users.find(u => u.id === post.userId)?.name.toLowerCase().includes(searchTerm.toLowerCase())
      );
      
      const filteredUsers = users.filter(user => 
        user.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
        user.department.toLowerCase().includes(searchTerm.toLowerCase())
      );
      
      const unreadNotifications = notifications.filter(
        n => n.userId === currentUser?.id && !n.read
      ).length;

      const handleLogin = async (userData) => {
  try {
    const res = await fetch(`${API_BASE}/api/auth/login`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        email: (userData.email || '').trim().toLowerCase(),
        password: userData.password || ''
      })
    });
    const data = await res.json();
    if (!res.ok) throw new Error(data.message || 'Invalid email or password');

    const DEFAULT_AVATAR = 'https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_1280.png';
    const existing = users.find(u => u.id === data.id);
    const pick = (sv, lv) => (lv && (sv === undefined || sv === null || sv === '' || sv === DEFAULT_AVATAR)) ? lv : sv;
    const merged = existing ? {
      ...data,
      profilePic: pick(data.profilePic, existing.profilePic),
      coverPic: pick(data.coverPic, existing.coverPic),
      bio: existing.bio ?? data.bio,
      department: existing.department ?? data.department,
      batch: existing.batch ?? data.batch,
      section: existing.section ?? data.section
    } : data;

    const updatedUsers = existing ? users.map(u => u.id === data.id ? merged : u) : [...users, merged];
    setUsers(updatedUsers);
    try { db.saveUsers(updatedUsers); } catch (e) {}

    setCurrentUser(merged);
    try { localStorage.setItem('vv_user', JSON.stringify(merged)); } catch (e) {}

    const updatedNotifications = notifications.map(n => (n.userId === merged.id ? { ...n, read: true } : n));
    setNotifications(updatedNotifications);
    try { db.saveNotifications(updatedNotifications); } catch (e) {}

    setView('home');
  } catch (err) {
    alert(err.message || 'Invalid email or password');
  }
};

      const handleSignup = (userData) => {
        const userExists = users.some(u => u.email === userData.email);
        if (userExists) {
          alert('User with this email already exists');
          return;
        }
        
        const newUser = {
          ...userData,
          id: users.length + 1,
          profilePic: `https://randomuser.me/api/portraits/${Math.random() > 0.5 ? 'men' : 'women'}/${Math.floor(Math.random() * 50)}.jpg`,
          coverPic: "https://images.unsplash.com/photo-1497366754035-f200968a6e72?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1000&q=80",
          bio: '',
          role: userData.role || 'student',
          phoneNumber: userData.phoneNumber || '',
          friends: [],
          universityId: `STU00${users.length + 1}`,
          universityEmail: `${userData.name.split(' ')[0].toLowerCase()}@univ.edu`,
          bloodGroup: ''
        };
        
        const updatedUsers = [...users, newUser];
        setUsers(updatedUsers);
        db.saveUsers(updatedUsers);
        setCurrentUser(newUser);
      };

      const handleLogout = () => {
        setCurrentUser(null);
        setView('home');
        setChattingWith(null);
      };

      const updateProfile = (updatedUser) => {
        const updatedUsers = users.map(u => u.id === updatedUser.id ? updatedUser : u);
        setUsers(updatedUsers);
        setCurrentUser(updatedUser);
        try { localStorage.setItem('vv_user', JSON.stringify(updatedUser)); } catch (e) {}
        try { db.saveUsers(updatedUsers); } catch (e) { alert('Storage is full. Try a smaller image.'); }
      };

      const addPost = (content, media = null, mediaType = null, category = "GENERAL") => {
        const newPost = {
          id: posts.length + 1,
          userId: currentUser.id,
          content,
          media,
          mediaType,
          likes: [],
          comments: [],
          shares: [],
          timestamp: new Date().toISOString(),
          category
        };
        const updatedPosts = [newPost, ...posts];
        setPosts(updatedPosts);
        try { db.savePosts(updatedPosts); } catch (e) { alert('Could not save post (storage may be full). Try a smaller image.'); }
      };

      const likePost = (postId) => {
        const updatedPosts = posts.map(post => {
          if (post.id === postId) {
            const isLiked = post.likes.includes(currentUser.id);
            const newLikes = isLiked 
              ? post.likes.filter(id => id !== currentUser.id)
              : [...post.likes, currentUser.id];
            
            // Create notification for post owner if it's a new like and not self-like
            if (!isLiked && post.userId !== currentUser.id) {
              const newNotification = {
                id: notifications.length + 1,
                userId: post.userId,
                type: 'like',
                fromUserId: currentUser.id,
                postId: post.id,
                message: `${currentUser.name} liked your post`,
                read: false,
                timestamp: new Date().toISOString()
              };
              const updatedNotifications = [...notifications, newNotification];
              setNotifications(updatedNotifications);
              db.saveNotifications(updatedNotifications);
            }
            
            return {
              ...post,
              likes: newLikes
            };
          }
          return post;
        });
        
        setPosts(updatedPosts);
        try { db.savePosts(updatedPosts); } catch (e) { alert('Could not save post (storage may be full). Try a smaller image.'); }
      };

      const addComment = (postId, text) => {
        const updatedPosts = posts.map(post => {
          if (post.id === postId) {
            const newComment = {
              id: post.comments.length + 1,
              userId: currentUser.id,
              text,
              timestamp: new Date().toISOString()
            };
            
            // Create notification for post owner if not self-comment
            if (post.userId !== currentUser.id) {
              const newNotification = {
                id: notifications.length + 1,
                userId: post.userId,
                type: 'comment',
                fromUserId: currentUser.id,
                postId: post.id,
                message: `${currentUser.name} commented on your post`,
                read: false,
                timestamp: new Date().toISOString()
              };
              const updatedNotifications = [...notifications, newNotification];
              setNotifications(updatedNotifications);
              db.saveNotifications(updatedNotifications);
            }
            
            return {
              ...post,
              comments: [...post.comments, newComment]
            };
          }
          return post;
        });
        setPosts(updatedPosts);
        try { db.savePosts(updatedPosts); } catch (e) { alert('Could not save post (storage may be full). Try a smaller image.'); }
      };

      const sharePost = (postId) => {
  const postToShare = posts.find(p => p.id === postId);
  if (postToShare) {
    if (postToShare.userId !== currentUser.id) {
      const newNotification = {
        id: notifications.length + 1,
        userId: postToShare.userId,
        type: 'share',
        fromUserId: currentUser.id,
        postId: postToShare.id,
        message: `${currentUser.name} shared your post`,
        read: false,
        timestamp: new Date().toISOString()
      };
      const updatedNotifications = [...notifications, newNotification];
      setNotifications(updatedNotifications);
      db.saveNotifications(updatedNotifications);
    }
    addPost(`Shared: ${postToShare.content}`, postToShare.media, postToShare.mediaType);
  }
};

      const sendFriendRequest = (toUserId) => {
        // Create notification
        const newNotification = {
          id: notifications.length + 1,
          userId: toUserId,
          type: 'friend_request',
          fromUserId: currentUser.id,
          message: `${currentUser.name} sent you a friend request`,
          read: false,
          timestamp: new Date().toISOString()
        };
        const updatedNotifications = [...notifications, newNotification];
        setNotifications(updatedNotifications);
        db.saveNotifications(updatedNotifications);
        
        alert(`Friend request sent to ${users.find(u => u.id === toUserId)?.name}`);
      };

      const acceptFriendRequest = (notificationId, fromUserId) => {
        // Add friend to both users
        const updatedUsers = users.map(user => {
          if (user.id === currentUser.id) {
            return {...user, friends: [...user.friends, fromUserId]};
          } else if (user.id === fromUserId) {
            return {...user, friends: [...user.friends, currentUser.id]};
          }
          return user;
        });
        
        setUsers(updatedUsers);
        setCurrentUser(updatedUsers.find(u => u.id === currentUser.id));
        db.saveUsers(updatedUsers);
        
        // Remove the notification
        const updatedNotifications = notifications.filter(n => n.id !== notificationId);
        setNotifications(updatedNotifications);
        db.saveNotifications(updatedNotifications);
      };

      const joinClub = (clubId) => {
        const updatedClubs = clubs.map(club => {
          if (club.id === clubId && !club.members.includes(currentUser.id)) {
            return {...club, members: [...club.members, currentUser.id]};
          }
          return club;
        });
        
        setClubs(updatedClubs);
        db.saveClubs(updatedClubs);
      };

      const deletePost = (postId) => {
        if (window.confirm("Are you sure you want to delete this post?")) {
          const updatedPosts = posts.filter(post => post.id !== postId);
          setPosts(updatedPosts);
          try { db.savePosts(updatedPosts); } catch (e) { alert('Could not save post (storage may be full). Try a smaller image.'); }
        }
      };

      const viewUserProfile = (userId) => {
        setViewingProfileId(userId);
        setView('profile');
      };
      
      const viewClub = (clubId) => {
        setViewingClubId(clubId);
        setView('club-details');
      };
      
 // In your App component, update the startChat function:
const startChat = (userId) => {
    const user = users.find(u => u.id === userId);
    if (user) {
        setChattingWith(user);
        setView('chat');
        
        // Setup WebSocket connection
        const socket = new SockJS(`${API_BASE}/ws-chat`);
        const client = Stomp.over(socket);
        
        client.connect({}, function(frame) {
            setStompClient(client);
            
            // Subscribe to personal queue
            client.subscribe(`/user/${currentUser.id}/queue/messages`, function(message) {
                const newMessage = JSON.parse(message.body);
                setMessages(prev => [...prev, newMessage]);
            });
            
            // Subscribe to typing notifications
            client.subscribe(`/user/${currentUser.id}/queue/typing`, function(notification) {
                const typingNotification = JSON.parse(notification.body);
                if (typingNotification.senderId === chattingWith.id) {
                    setIsTyping(typingNotification.typing);
                }
            });
            
            // Load conversation history
            fetch(`/api/messages/conversation/${user.id}`)
                .then(response => response.json())
                .then(data => {
                    setMessages(data);
                })
                .catch(error => console.error('Error loading messages:', error));
        });
    }
};

// Update the sendMessage function:
const sendMessage = () => {
    if (newMessage.trim() && chattingWith && stompClient) {
        const message = {
            sender: { id: currentUser.id },
            receiver: { id: chattingWith.id },
            content: newMessage,
            timestamp: new Date().toISOString(),
            read: false
        };
        
        // Send via WebSocket
        stompClient.send("/app/chat.send", {}, JSON.stringify(message));
        
        // Also send via REST API to persist
        fetch(`${API_BASE}/api/messages/send`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                receiverId: chattingWith.id,
                content: newMessage
            })
        })
        .catch(error => console.error('Error saving message:', error));
        
        setNewMessage('');
    }
};

// Add typing indicator handler
const handleTyping = (isTyping) => {
    if (stompClient && chattingWith) {
        stompClient.send("/app/chat.typing", {}, JSON.stringify({
            senderId: currentUser.id,
            receiverId: chattingWith.id,
            typing: isTyping
        }));
    }
};
      
      const registerAsDonor = (bloodGroup) => {
        const updatedUsers = users.map(user => 
          user.id === currentUser.id ? {...user, bloodGroup} : user
        );
        
        setUsers(updatedUsers);
        setCurrentUser({...currentUser, bloodGroup});
        db.saveUsers(updatedUsers);
        
        alert(`Registered as ${bloodGroup} blood donor!`);
      };
      
      const createTournament = (tournament) => {
        const newTournament = {
          ...tournament,
          id: tournaments.length + 1,
          organizerId: currentUser.id,
          participants: [currentUser.id]
        };
        
        const updatedTournaments = [...tournaments, newTournament];
        setTournaments(updatedTournaments);
        db.saveTournaments(updatedTournaments);
      };
      
      const registerForTournament = (tournamentId) => {
        const updatedTournaments = tournaments.map(t => {
          if (t.id === tournamentId && !t.participants.includes(currentUser.id)) {
            return {...t, participants: [...t.participants, currentUser.id]};
          }
          return t;
        });
        
        setTournaments(updatedTournaments);
        db.saveTournaments(updatedTournaments);
      };

      if (!currentUser) {
        return <AuthPage onLogin={handleLogin} onSignup={handleSignup} />;
      }

      switch(view) {
        case 'profile':
          const profileUser = viewingProfileId 
            ? users.find(u => u.id === viewingProfileId) 
            : currentUser;
          return (
            <ProfilePage 
              user={profileUser} 
              currentUser={currentUser}
              onLogout={handleLogout} 
              onBack={() => {
                setView('home');
                setViewingProfileId(null);
              }}
              onUpdate={updateProfile}
              posts={posts.filter(p => p.userId === profileUser.id)}
              onDeletePost={deletePost}
              onSendRequest={sendFriendRequest}
              onViewProfile={viewUserProfile}
              onStartChat={startChat}
            />
          );
        case 'clubs':
          return <ClubsPage 
            onBack={() => setView('home')} 
            clubs={clubs} 
            currentUser={currentUser}
            onJoin={joinClub}
            onViewClub={viewClub}
          />;
        case 'club-details':
          const club = clubs.find(c => c.id === viewingClubId);
          const clubPosts = posts.filter(p => p.category === 'CLUB' && p.clubId === viewingClubId);
          return (
            <ClubDetailsPage 
              club={club} 
              onBack={() => setView('clubs')} 
              posts={clubPosts}
              currentUser={currentUser}
            />
          );
        case 'sports':
          return <SportsPage 
            onBack={() => setView('home')} 
            tournaments={tournaments}
            posts={posts.filter(p => p.category === 'SPORTS')}
            currentUser={currentUser}
            users={users}
            onRegister={registerForTournament}
            onCreate={createTournament}
          />;
        case 'blood-donors':
          return <BloodDonorsPage 
            onBack={() => setView('home')} 
            users={users}
            currentUser={currentUser}
            onRegister={registerAsDonor}
            onContact={startChat}
          />;
        case 'search':
          return (
            <SearchPage 
              onBack={() => setView('home')}
              posts={filteredPosts}
              users={filteredUsers}
              currentUser={currentUser}
              onSendRequest={sendFriendRequest}
              onLikePost={likePost}
              onAddComment={addComment}
              onDeletePost={deletePost}
              onViewProfile={viewUserProfile}
              onStartChat={startChat}
            />
          );
        case 'notifications':
          return (
            <NotificationsPage 
              onBack={() => setView('home')}
              notifications={notifications.filter(n => n.userId === currentUser.id)}
              users={users}
              onAcceptRequest={acceptFriendRequest}
              onViewProfile={viewUserProfile}
            />
          );
       case 'chat':
          return (
            <ErrorBoundary>
              <ChatPage
                user={chattingWith}
                currentUser={currentUser}
                messages={messages}
                newMessage={newMessage}
                isTyping={isTyping}
                onBack={() => setView('home')}
                onMessageChange={setNewMessage}
                onSend={sendMessage}
                onTyping={handleTyping}
              />
            </ErrorBoundary>
          );
        default:
          return (
            <HomePage 
              user={currentUser} 
              users={users}
              posts={posts} 
              clubs={clubs}
              onLogout={handleLogout}
              onAddPost={addPost}
              onNavigate={setView}
              onLikePost={likePost}
              onAddComment={addComment}
              onSharePost={sharePost}
              onSearch={(term) => {
                setSearchTerm(term);
                setView('search');
              }}
              unreadNotifications={unreadNotifications}
              onToggleNotifications={() => setShowNotifications(!showNotifications)}
              showNotifications={showNotifications}
              notifications={notifications.filter(n => n.userId === currentUser.id)}
              onAcceptRequest={acceptFriendRequest}
              onDeletePost={deletePost}
              onViewProfile={viewUserProfile}
              onStartChat={startChat}
            />
          );
      }
    }

     // Error Boundary Component
    function ErrorBoundary({ children }) {
      const [hasError, setHasError] = React.useState(false);
      
      React.useEffect(() => {
        const errorHandler = (error) => {
          console.error('Error caught:', error);
          setHasError(true);
        };
        window.addEventListener('error', errorHandler);
        return () => window.removeEventListener('error', errorHandler);
      }, []);
      
      if (hasError) {
        return <div className="p-4 bg-red-100 text-red-800">Component Error Occurred</div>;
      }
      return children;
    }

    // ======================
    // Auth Page Component
    // ======================
    function AuthPage({ onLogin, onSignup }) {
  const [isLogin, setIsLogin] = React.useState(true);
  const [form, setForm] = React.useState({
    name: '',
    email: '',
    password: '',
    department: '',
    batch: '',
    section: '',
    phoneNumber: '',
    role: 'student'
  });
  const [loading, setLoading] = React.useState(false);
  const [error, setError] = React.useState('');
  const [otpSent, setOtpSent] = React.useState(false);
  const [otp, setOtp] = React.useState('');

  const handleChange = (e) => {
    const { name, value } = e.target;
    setForm((prev) => ({ ...prev, [name]: value }));
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    setLoading(true);
    setError('');

    try {
      if (isLogin) {
        onLogin({ email: form.email, password: form.password });
      } else {
        if (!otpSent) {
          if (!form.email.endsWith('@diu.edu.bd')) {
            setError("Only university emails allowed");
            setLoading(false);
            return;
          }
          const res = await fetch(`${API_BASE}/api/auth/request-otp`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(form)
          });
          if (res.ok) {
            alert('OTP sent to your email');
            setOtpSent(true);
          } else {
            const msg = await res.text();
            setError(msg || "Failed to send OTP");
          }
        } else {
          const res = await fetch(`${API_BASE}/api/auth/verify-otp`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ ...form, otp })
          });
          if (res.ok) {
            alert("Signup successful!");
            onSignup({
              name: form.name,
              email: form.email,
              department: form.department,
              batch: form.batch,
              section: form.section,
              phoneNumber: form.phoneNumber,
              role: form.role,
              password: form.password
            });
            setOtpSent(false);
            setForm({
              name: '',
              email: '',
              password: '',
              department: '',
              batch: '',
              section: '',
              phoneNumber: '',
              role: 'student'
            });
            setOtp('');
          } else {
            const msg = await res.text();
            setError(msg || "OTP verification failed");
          }
        }
      }
    } catch (err) {
      setError(err.message || 'An error occurred');
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="min-h-screen flex items-center justify-center gradient-bg p-4">
      <div className="bg-white rounded-xl shadow-xl p-8 w-full max-w-md glass-effect">
        <div className="text-center mb-6">
          <div className="inline-block bg-gradient-to-r from-purple-500 to-indigo-600 p-4 rounded-full mb-3 floating">
            <i className="fas fa-user-graduate text-4xl text-white"></i>
          </div>
          <h1 className="text-3xl font-bold gradient-text">VarsityVive</h1>
          <p className="text-gray-600 mt-1">
            Connect, Share, and Grow with Campus Life
          </p>
          <p className="text-gray-500 text-sm mt-2">
            {isLogin ? 'Sign in to your account' : 'Create new account'}
          </p>
        </div>

        {error && (
          <div className="mb-4 p-2 bg-red-100 text-red-700 rounded text-center">
            {error}
          </div>
        )}

        {/* OTP Overlay Page */}
        {!isLogin && otpSent && (
          <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
            <div className="absolute inset-0 bg-black/30 backdrop-blur-sm"></div>
            <div className="relative bg-white rounded-2xl shadow-2xl w-full max-w-md p-8 glass-effect fade-in">
              <div className="text-center mb-6">
                <div className="inline-block bg-gradient-to-r from-purple-500 to-indigo-600 p-4 rounded-full mb-3 floating">
                  <i className="fas fa-user-graduate text-4xl text-white"></i>
                </div>
                <h2 className="text-3xl font-bold gradient-text">Email Verification</h2>
                <p className="text-gray-600 mt-1">
                  We sent a one-time code to <span className="font-semibold">{form.email}</span>
                </p>
              </div>
              {error && (
                <div className="mb-4 p-2 bg-red-100 text-red-700 rounded text-center">
                  {error}
                </div>
              )}
              <form onSubmit={handleSubmit} className="space-y-4">
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">Enter OTP</label>
                  <input
                    name="otp"
                    placeholder="6-digit code"
                    value={otp}
                    onChange={(e) => setOtp(e.target.value)}
                    className="w-full p-3 border rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent tracking-widest text-center text-lg"
                    required
                  />
                  <p className="text-xs text-gray-500 mt-1">Code is valid for 5 minutes.</p>
                </div>
                <button
                  type="submit"
                  disabled={loading}
                  className="w-full btn-primary p-3 rounded-lg disabled:opacity-50 transition duration-300 font-medium"
                >
                  {loading ? (
                    <span className="flex items-center justify-center">
                      <i className="fas fa-spinner fa-spin mr-2"></i> Verifying...
                    </span>
                  ) : 'Verify & Create Account'}
                </button>
                <button
                  type="button"
                  className="w-full p-3 rounded-lg border hover:bg-gray-50 transition duration-300"
                  onClick={() => setOtpSent(false)}
                >
                  Go back
                </button>
              </form>
              <p className="text-xs text-gray-500 text-center mt-4">
                Didnâ€™t get the code? Check spam or try again after 1 minute.
              </p>
            </div>
          </div>
        )}

        <form onSubmit={handleSubmit} className="space-y-4">
          {!isLogin && (
            <>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
                <input
                  name="name"
                  placeholder="John Smith"
                  value={form.name}
                  onChange={handleChange}
                  className="w-full p-3 border rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                  required
                />
              </div>

              <div className="grid grid-cols-2 gap-3">
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">Department</label>
                  <input
                    name="department"
                    placeholder="Computer Science"
                    value={form.department}
                    onChange={handleChange}
                    className="w-full p-3 border rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                    required
                  />
                </div>
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">Batch</label>
                  <input
                    name="batch"
                    placeholder="2023"
                    value={form.batch}
                    onChange={handleChange}
                    className="w-full p-3 border rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                    required
                  />
                </div>
              </div>

              {/* Phone first */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">Phone Number</label>
                <input
                  name="phoneNumber"
                  placeholder="01XXXXXXXXX"
                  pattern="01[0-9]{9}"
                  title="Enter valid 11-digit BD number starting with 01"
                  value={form.phoneNumber}
                  onChange={handleChange}
                  className="w-full p-3 border rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                  required
                />
              </div>

              {/* Then Section */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">Section</label>
                <input
                  name="section"
                  placeholder="A"
                  value={form.section}
                  onChange={handleChange}
                  className="w-full p-3 border rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                  required
                />
              </div>

              {/* Then Role */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Role</label>
                <div className="grid grid-cols-3 gap-2">
                  {['student','admin','faculty'].map(r => (
                    <label key={r} className={`flex items-center justify-center p-3 rounded-lg border cursor-pointer ${form.role===r?'border-purple-500 bg-purple-50':''}`}>
                      <input
                        type="radio"
                        name="role"
                        value={r}
                        checked={form.role === r}
                        onChange={handleChange}
                        className="hidden"
                      />
                      <span className="capitalize">{r}</span>
                    </label>
                  ))}
                </div>
              </div>
            </>
          )}

          <div>
            <label className="block text-sm font-medium text-gray-700 mb-1">Email</label>
            <input
              name="email"
              type="email"
              placeholder="you@varsity.edu"
              value={form.email}
              onChange={handleChange}
              className="w-full p-3 border rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
              required
            />
          </div>

          <div>
            <label className="block text-sm font-medium text-gray-700 mb-1">Password</label>
            <input
              name="password"
              type="password"
              placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
              value={form.password}
              onChange={handleChange}
              className="w-full p-3 border rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
              required
            />
          </div>

          <button
            type="submit"
            disabled={loading}
            className="w-full btn-primary p-3 rounded-lg disabled:opacity-50 transition duration-300 font-medium"
          >
            {loading ? (
              <span className="flex items-center justify-center">
                <i className="fas fa-spinner fa-spin mr-2"></i> Processing...
              </span>
            ) : isLogin ? 'Sign In' : 'Create Account'}
          </button>
        </form>

        <div className="mt-6 text-center">
          <button
            onClick={() => { setIsLogin(!isLogin); setError(''); }}
            className="text-purple-600 font-medium hover:text-purple-800 transition duration-300"
          >
            {isLogin ? "Don't have an account? Sign up" : "Already have an account? Sign in"}
          </button>
        </div>

        <div className="mt-6 text-center">
          <p className="text-sm text-gray-500 mb-3">Or continue with</p>
          <button className="flex items-center justify-center w-full p-3 border rounded-lg hover:bg-gray-50 transition duration-300">
            <img 
              src="https://www.google.com/images/branding/googleg/1x/googleg_standard_color_128dp.png" 
              alt="Google logo"
              className="w-5 h-5 mr-3"
            />
            Sign in with Google
          </button>
        </div>
      </div>
    </div>
  );
}// ======================
    // Home Page Component
    // ======================
     function HomePage({ 
      user, users, posts, clubs, onLogout, onAddPost, onNavigate, 
      onLikePost, onAddComment, onSharePost, onSearch, unreadNotifications, 
      onToggleNotifications, showNotifications, notifications, onAcceptRequest, 
      onDeletePost, onViewProfile, onStartChat, conversations 
    }) {
      const [postContent, setPostContent] = React.useState('');
      const [commentTexts, setCommentTexts] = React.useState({});
      const [selectedFile, setSelectedFile] = React.useState(null);
      const [showCommentBox, setShowCommentBox] = React.useState(null);

      const handleFileChange = (e) => {
        if (e.target.files[0]) {
          const file = e.target.files[0];
          const reader = new FileReader();
          reader.onload = (event) => {
            setSelectedFile({
              data: event.target.result,
              type: file.type.startsWith('image') ? 'image' : 'video'
            });
          };
          reader.readAsDataURL(file);
        }
      };

      const handleSubmit = (e) => {
        e.preventDefault();
        if (postContent.trim() || selectedFile) {
          onAddPost(
            postContent, 
            selectedFile ? selectedFile.data : null,
            selectedFile ? (selectedFile.type.startsWith('image') ? 'image' : 'video') : null
          );
          setPostContent('');
          setSelectedFile(null);
        }
      };

      const handleCommentSubmit = (postId) => {
        const text = commentTexts[postId] || '';
        if (text.trim()) {
          onAddComment(postId, text);
          setCommentTexts({ ...commentTexts, [postId]: '' });
          setShowCommentBox(null);
        }
      };

      const getUserById = (id) => {
        const user = users.find(u => u.id === id);
        if (!user) {
          return { 
            id: 0,
            name: 'Unknown User', 
            profilePic: 'https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_1280.png',
            department: 'Unknown',
            friends: []
          };
        }
        return user;
      };

      return (
        <div className="min-h-screen bg-gray-50">
          <header className="header-gradient sticky top-0 z-50">
            <div className="max-w-6xl mx-auto px-4 py-3 flex justify-between items-center">
              <div className="flex items-center space-x-2">
                <div className="bg-white p-2 rounded-lg">
                  <i className="fas fa-user-graduate text-xl gradient-text"></i>
                </div>
                <h1 className="text-xl font-bold text-white">VarsityVive</h1>
              </div>
              
              <div className="flex-1 mx-4">
                <div className="relative">
                  <input
                    type="text"
                    placeholder="Search people, posts, clubs..."
                    className="w-full p-2 pl-10 border-0 rounded-full focus:ring-2 focus:ring-white focus:border-transparent"
                    onChange={(e) => onSearch(e.target.value)}
                  />
                  <i className="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                </div>
              </div>
              
              <div className="flex items-center space-x-4">
                <div className="relative">
                  <button 
                    onClick={onToggleNotifications}
                    className="p-2 rounded-full hover:bg-white/20 relative"
                  >
                    <i className="fas fa-bell text-xl text-white"></i>
                    {unreadNotifications > 0 && (
                      <span className="notification-badge">
                        {unreadNotifications}
                      </span>
                    )}
                  </button>
                  
                  {showNotifications && (
                    <div className="absolute right-0 mt-2 w-80 bg-white rounded-lg shadow-xl border z-20 glass-effect" style={{maxHeight: '70vh', overflowY: 'auto'}}>
                      <div className="p-3 border-b">
                        <h3 className="font-semibold">Notifications</h3>
                      </div>
                      <div>
                        {notifications.slice(0, 5).map(notification => {
                          const fromUser = getUserById(notification.fromUserId);
                          return (
                            <div 
                              key={notification.id} 
                              className={`p-3 border-b ${notification.read ? 'bg-white' : 'bg-blue-50'} fade-in`}
                            >
                              <div className="flex items-start">
                                <img 
                                  src={fromUser?.profilePic} 
                                  alt="Profile" 
                                  className="w-8 h-8 rounded-full mr-2"
                                />
                                <div className="flex-1">
                                  <p className="text-sm">{notification.message}</p>
                                  <p className="text-xs text-gray-500 mt-1">
                                    {new Date(notification.timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}
                                  </p>
                                  {notification.type === 'friend_request' && (
                                    <div className="mt-2 flex space-x-2">
                                      <button 
                                        onClick={() => onAcceptRequest(notification.id, notification.fromUserId)}
                                        className="text-xs btn-primary px-2 py-1 rounded"
                                      >
                                        Accept
                                      </button>
                                      <button className="text-xs bg-gray-200 px-2 py-1 rounded">
                                        Decline
                                      </button>
                                    </div>
                                  )}
                                </div>
                              </div>
                            </div>
                          );
                        })}
                        {notifications.length === 0 && (
                          <div className="p-4 text-center text-gray-500">
                            No notifications
                          </div>
                        )}
                        {notifications.length > 5 && (
                          <button 
                            onClick={() => onNavigate('notifications')}
                            className="w-full py-2 text-center text-purple-600 font-medium hover:bg-gray-50"
                          >
                            See all notifications
                          </button>
                        )}
                      </div>
                    </div>
                  )}
                </div>
                
                <button 
                  onClick={() => onViewProfile(user.id)}
                  className="flex items-center space-x-2 group"
                >
                  <img 
                    src={user.profilePic} 
                    alt="Profile" 
                    className="w-8 h-8 rounded-full border-2 border-transparent group-hover:border-white"
                  />
                  <span className="hidden md:block font-medium text-white">{(user?.name || 'User').split(' ')[0]}</span>
                </button>
              </div>
            </div>
          </header>

          <div className="max-w-6xl mx-auto p-4 grid grid-cols-1 md:grid-cols-12 gap-6">
            {/* Left sidebar */}
            <div className="md:col-span-3 space-y-4">
              <div className="vibrant-card p-4">
                <div className="flex items-center mb-4">
                  <img 
                    src={user.profilePic} 
                    alt={user.name} 
                    className="w-12 h-12 rounded-full mr-3"
                  />
                  <div>
                    <h3 className="font-bold">{user.name}</h3>
                    <p className="text-xs text-gray-500">{user.department}</p>
                  </div>
                </div>
                
                <ul className="space-y-1">
                  <li>
                    <button 
                      onClick={() => onNavigate('home')}
                      className="flex items-center w-full p-2 rounded-lg hover:bg-purple-50 text-purple-600"
                    >
                      <i className="fas fa-home mr-3 text-lg"></i> 
                      <span>Home</span>
                    </button>
                  </li>
                  <li>
                    <button 
                      onClick={() => onViewProfile(user.id)}
                      className="flex items-center w-full p-2 rounded-lg hover:bg-purple-50"
                    >
                      <i className="fas fa-user mr-3 text-lg"></i> 
                      <span>Profile</span>
                    </button>
                  </li>
                  <li>
                    <button 
                      onClick={() => onNavigate('clubs')}
                      className="flex items-center w-full p-2 rounded-lg hover:bg-purple-50"
                    >
                      <i className="fas fa-users mr-3 text-lg"></i> 
                      <span>Clubs</span>
                    </button>
                  </li>
                  <li>
                    <button 
                      onClick={() => onNavigate('sports')}
                      className="flex items-center w-full p-2 rounded-lg hover:bg-purple-50"
                    >
                      <i className="fas fa-running mr-3 text-lg"></i> 
                      <span>Sports</span>
                    </button>
                  </li>
                  <li>
                    <button 
                      onClick={() => onNavigate('blood-donors')}
                      className="flex items-center w-full p-2 rounded-lg hover:bg-purple-50"
                    >
                      <i className="fas fa-heart mr-3 text-lg"></i> 
                      <span>Blood Donors</span>
                    </button>
                  </li>
                  <li>
                    <button 
                      onClick={onLogout}
                      className="flex items-center w-full p-2 rounded-lg hover:bg-red-50 text-red-600"
                    >
                      <i className="fas fa-sign-out-alt mr-3 text-lg"></i> 
                      <span>Logout</span>
                    </button>
                  </li>
                </ul>
              </div>

              <div className="vibrant-card p-4">
                <h2 className="font-semibold mb-3">Friends ({user.friends.length})</h2>
                <div className="space-y-3">
                  {user.friends.slice(0, 5).map(friendId => {
                    const friend = getUserById(friendId);
                    return friend ? (
                      <div key={friendId} className="flex items-center">
                        <img 
                          src={friend.profilePic} 
                          alt={friend.name} 
                          className="w-10 h-10 rounded-full mr-2"
                          onClick={() => onViewProfile(friend.id)}
                          style={{cursor: 'pointer'}}
                        />
                        <span 
                          className="font-medium hover:text-purple-600 cursor-pointer"
                          onClick={() => onViewProfile(friend.id)}
                        >
                          {friend.name.split(' ')[0]}
                        </span>
                      </div>
                    ) : null;
                  })}
                  {user.friends.length > 5 && (
                    <button 
                      onClick={() => onViewProfile(user.id)}
                      className="text-purple-600 text-sm font-medium"
                    >
                      See all friends
                    </button>
                  )}
                </div>
              </div>
              
              <div className="vibrant-card p-4">
                <h2 className="font-semibold mb-3">Upcoming Events</h2>
                <div className="space-y-3">
                  <div className="p-3 bg-gradient-to-r from-purple-50 to-blue-50 rounded-lg">
                    <h3 className="font-medium">Tech Symposium</h3>
                    <p className="text-xs text-gray-500">June 10, 2023 â€¢ CS Dept.</p>
                  </div>
                  <div className="p-3 bg-gradient-to-r from-purple-50 to-blue-50 rounded-lg">
                    <h3 className="font-medium">Sports Day</h3>
                    <p className="text-xs text-gray-500">June 15, 2023 â€¢ Stadium</p>
                  </div>
                  <button className="text-purple-600 text-sm font-medium">
                    See all events
                  </button>
                </div>
              </div>
            </div>

            {/* Main content */}
            <div className="md:col-span-6 space-y-4">
              <div className="vibrant-card p-4">
                <form onSubmit={handleSubmit} className="space-y-3">
                  <textarea
                    placeholder={`What's on your mind, ${(user?.name || 'User').split(' ')[0]}?`}
                    value={postContent}
                    onChange={(e) => setPostContent(e.target.value)}
                    className="w-full p-3 border rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                    rows="3"
                  />
                  <div className="flex items-center justify-between">
                    <div className="flex space-x-4">
                      <label className="cursor-pointer flex items-center text-gray-600 hover:text-purple-600">
                        <i className="fas fa-image text-lg mr-1"></i>
                        <span className="text-sm">Photo/Video</span>
                        <input 
                          type="file" 
                          accept="image/*,video/*" 
                          onChange={handleFileChange}
                          className="hidden"
                        />
                      </label>
                      <button className="flex items-center text-gray-600 hover:text-purple-600">
                        <i className="fas fa-user-friends text-lg mr-1"></i>
                        <span className="text-sm">Tag Friends</span>
                      </button>
                    </div>
                    <button
                      type="submit"
                      disabled={!postContent.trim() && !selectedFile}
                      className="btn-primary px-4 py-2 rounded-lg disabled:opacity-50"
                    >
                      Post
                    </button>
                  </div>
                  {selectedFile && (
                    <div className="relative mt-3">
                      {selectedFile.type === 'image' ? (
                        <img 
                          src={selectedFile.data} 
                          alt="Preview" 
                          className="max-h-60 w-full object-cover rounded-lg"
                        />
                      ) : (
                        <video controls className="w-full rounded-lg">
                          <source src={selectedFile.data} type="video/mp4" />
                        </video>
                      )}
                      <button
                        type="button"
                        onClick={() => setSelectedFile(null)}
                        className="absolute top-2 right-2 bg-gray-800 bg-opacity-75 text-white rounded-full w-8 h-8 flex items-center justify-center hover:bg-opacity-100"
                      >
                        <i className="fas fa-times"></i>
                      </button>
                    </div>
                  )}
                </form>
              </div>

              <div className="space-y-4">
                {posts.map(post => {
                  const postUser = getUserById(post.userId);
                  return (
                    <div key={post.id} className="vibrant-card p-4 fade-in">
                      <div className="flex items-center mb-3">
                        <img 
                          src={postUser.profilePic} 
                          alt={postUser.name} 
                          className="w-10 h-10 rounded-full mr-3"
                          onClick={() => onViewProfile(postUser.id)}
                          style={{cursor: 'pointer'}}
                        />
                        <div>
                          <h3 
                            className="font-semibold hover:text-purple-600 cursor-pointer"
                            onClick={() => onViewProfile(postUser.id)}
                          >
                            {postUser.name}
                          </h3>
                          <p className="text-xs text-gray-500">
                            {new Date(post.timestamp).toLocaleDateString()} â€¢ {new Date(post.timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}
                          </p>
                        </div>
                        {post.userId === user.id && (
                          <div className="ml-auto">
                            <button 
                              onClick={() => onDeletePost(post.id)}
                              className="text-red-500 hover:text-red-700"
                            >
                              <i className="fas fa-trash"></i>
                            </button>
                          </div>
                        )}
                      </div>
                      
                      <p className="mb-3">{post.content}</p>
                      
                      {post.media && (
                        <div className="mb-4 rounded-lg overflow-hidden">
                          {post.mediaType === 'image' ? (
                            <img 
                              src={post.media} 
                              alt="Post media" 
                              className="w-full max-h-96 object-cover"
                            />
                          ) : (
                            <video controls className="w-full">
                              <source src={post.media} type="video/mp4" />
                            </video>
                          )}
                        </div>
                      )}
                      
                      <div className="flex justify-between text-sm text-gray-500 mb-2">
                        <div className="flex items-center">
                          <div className="flex">
                            {post.likes.slice(0, 3).map((likeId, index) => {
                              const likeUser = getUserById(likeId);
                              return (
                                <img 
                                  key={likeId} 
                                  src={likeUser?.profilePic} 
                                  alt="Like" 
                                  className={`w-5 h-5 rounded-full border-2 border-white ${index > 0 ? '-ml-2' : ''}`}
                                  onClick={() => onViewProfile(likeUser.id)}
                                  style={{cursor: 'pointer'}}
                                />
                              );
                            })}
                          </div>
                          <span className="ml-2">{post.likes.length} likes</span>
                        </div>
                        <span>
                          {post.comments.length} comments â€¢ {post.shares.length} shares
                        </span>
                      </div>
                      
                      <div className="border-t border-b py-2 flex justify-around">
                        <button 
                          onClick={() => onLikePost(post.id)}
                          className={`flex items-center font-medium ${post.likes.includes(user.id) ? 'text-blue-500' : 'text-gray-600'}`}
                        >
                          <i className={`fas fa-thumbs-up mr-1 ${post.likes.includes(user.id) ? 'text-blue-500' : ''}`}></i> Like
                        </button>
                        <button 
                          onClick={() => setShowCommentBox(showCommentBox === post.id ? null : post.id)}
                          className="flex items-center font-medium text-gray-600"
                        >
                          <i className="fas fa-comment mr-1"></i> Comment
                        </button>
                        <button 
                          onClick={() => onSharePost(post.id)}
                          className="flex items-center font-medium text-gray-600"
                        >
                          <i className="fas fa-share mr-1"></i> Share
                        </button>
                        
                      </div>
                      
                      {/* Comments section */}
                      {showCommentBox === post.id && (
                        <div className="mt-3">
                          {/* Add comment */}
                          <div className="flex mb-3">
                            <img 
                              src={user.profilePic} 
                              alt={user.name} 
                              className="w-8 h-8 rounded-full mr-2"
                            />
                            <div className="flex-1 flex bg-gray-100 rounded-full">
                              <input
                                type="text"
                                placeholder="Write a comment..."
                                value={commentTexts[post.id] || ''}
                                onChange={(e) => setCommentTexts({
                                  ...commentTexts,
                                  [post.id]: e.target.value
                                })}
                                className="flex-1 p-2 bg-transparent focus:outline-none"
                                onKeyPress={(e) => e.key === 'Enter' && handleCommentSubmit(post.id)}
                              />
                              <button
                                onClick={() => handleCommentSubmit(post.id)}
                                className="text-purple-600 px-3"
                              >
                                <i className="fas fa-paper-plane"></i>
                              </button>
                            </div>
                          </div>
                          
                          {/* Existing comments */}
                          {post.comments.length > 0 && (
                            <div className="space-y-2">
                              {post.comments.map((comment, index) => {
                                const commentUser = getUserById(comment.userId);
                                return (
                                  <div key={index} className="flex items-start">
                                    <img 
                                      src={commentUser.profilePic} 
                                      alt={commentUser.name} 
                                      className="w-6 h-6 rounded-full mr-2 mt-1"
                                      onClick={() => onViewProfile(commentUser.id)}
                                      style={{cursor: 'pointer'}}
                                    />
                                    <div className="bg-gray-100 p-3 rounded-xl flex-1">
                                      <div 
                                        className="font-medium text-sm hover:text-purple-600 cursor-pointer"
                                        onClick={() => onViewProfile(commentUser.id)}
                                      >
                                        {commentUser.name}
                                      </div>
                                      <div>{comment.text}</div>
                                      <div className="text-xs text-gray-500 mt-1">
                                        {new Date(comment.timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}
                                      </div>
                                    </div>
                                  </div>
                                );
                              })}
                            </div>
                          )}
                        </div>
                      )}
                    </div>
                  );
                })}
              </div>
            </div>

            {/* Right sidebar */}
            <div className="md:col-span-3 space-y-4">
              <div className="vibrant-card p-4">
                <h2 className="font-semibold mb-3">Suggested Friends</h2>
                <div className="space-y-3">
                  {users.filter(u => 
                    u.id !== user.id && 
                    !user.friends.includes(u.id)
                  ).slice(0, 3).map(suggested => (
                    <div key={suggested.id} className="flex items-center justify-between">
                      <div className="flex items-center">
                        <img 
                          src={suggested.profilePic} 
                          alt={suggested.name} 
                          className="w-10 h-10 rounded-full mr-3"
                          onClick={() => onViewProfile(suggested.id)}
                          style={{cursor: 'pointer'}}
                        />
                        <div>
                          <h3 
                            className="font-medium hover:text-purple-600 cursor-pointer"
                            onClick={() => onViewProfile(suggested.id)}
                          >
                            {suggested.name}
                          </h3>
                          <p className="text-sm text-gray-500">{suggested.department}</p>
                        </div>
                      </div>
                      <button 
                        onClick={() => sendFriendRequest(suggested.id)}
                        className="btn-secondary px-3 py-1 text-sm rounded-lg"
                      >
                        Add
                      </button>
                    </div>
                  ))}
                </div>
              </div>
              
              <div className="vibrant-card p-4">
                <h2 className="font-semibold mb-3">Popular Clubs</h2>
                <div className="space-y-3">
                  <div className="p-3 bg-gradient-to-r from-purple-50 to-blue-50 rounded-lg">
                    <h3 className="font-medium">Robotics Club</h3>
                    <p className="text-xs text-gray-500">25 members â€¢ CS Dept.</p>
                  </div>
                  <div className="p-3 bg-gradient-to-r from-purple-50 to-blue-50 rounded-lg">
                    <h3 className="font-medium">Photography Club</h3>
                    <p className="text-xs text-gray-500">18 members â€¢ Arts</p>
                  </div>
                  <button 
                    onClick={() => onNavigate('clubs')}
                    className="text-purple-600 text-sm font-medium"
                  >
                    See all clubs
                  </button>
                </div>
              </div>
              
              <div className="vibrant-card p-4">
                <h2 className="font-semibold mb-3">Campus News</h2>
                <div className="space-y-3">
                  <div className="p-3 bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg">
                    <h3 className="font-medium">New Library Opening</h3>
                    <p className="text-xs text-gray-500">June 1, 2023</p>
                  </div>
                  <div className="p-3 bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg">
                    <h3 className="font-medium">Scholarship Opportunities</h3>
                    <p className="text-xs text-gray-500">May 28, 2023</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      );
    }

    // ======================
    // Profile Page Component
    // ======================
     function ProfilePage({ user, currentUser, onLogout, onBack, onUpdate, posts, onDeletePost, onSendRequest, onViewProfile, onStartChat }) {
      const [isEditing, setIsEditing] = React.useState(false);
      const [editedUser, setEditedUser] = React.useState({ ...user });
      const [profilePic, setProfilePic] = React.useState(user.profilePic);
      const [coverPic, setCoverPic] = React.useState(user.coverPic);
      const [fileInputKey, setFileInputKey] = React.useState(Date.now());
      const [showCommentBox, setShowCommentBox] = React.useState(null);
      const [commentTexts, setCommentTexts] = React.useState({});
      

      const isCurrentUserProfile = user.id === currentUser.id;

      const handleEdit = () => {
        setIsEditing(true);
      };

      const handleSave = () => {
        onUpdate({
          ...editedUser,
          profilePic: profilePic,
          coverPic: coverPic
        });
        setIsEditing(false);
      };

      const handleCancel = () => {
        setEditedUser({ ...user });
        setProfilePic(user.profilePic);
        setCoverPic(user.coverPic);
        setIsEditing(false);
      };

      const handleChange = (e) => {
        setEditedUser({
          ...editedUser,
          [e.target.name]: e.target.value
        });
      };

      const handleProfilePicChange = (e) => {
        if (e.target.files[0]) {
          const reader = new FileReader();
          reader.onload = (event) => {
            setProfilePic(event.target.result);
          };
          reader.readAsDataURL(e.target.files[0]);
        }
      };

      const handleCoverChange = (e) => {
        if (e.target.files[0]) {
          const reader = new FileReader();
          reader.onload = (event) => {
            setCoverPic(event.target.result);
          };
          reader.readAsDataURL(e.target.files[0]);
        }
      };

      const handleCommentSubmit = (postId) => {
        const text = commentTexts[postId] || '';
        if (text.trim()) {
          // This would need to be implemented in App component and passed down
          alert("Comment functionality would be implemented here");
          setCommentTexts({ ...commentTexts, [postId]: '' });
          setShowCommentBox(null);
        }
      };

      return (
        <div className="min-h-screen bg-gray-50">
          <header className="header-gradient">
            <div className="max-w-6xl mx-auto px-4 py-3 flex justify-between items-center">
              <button onClick={onBack} className="flex items-center text-white font-medium">
                <i className="fas fa-arrow-left mr-2"></i> Back
              </button>
              <div>
                {isCurrentUserProfile && isEditing ? (
                  <div className="flex space-x-2">
                    <button 
                      onClick={handleSave}
                      className="bg-green-600 text-white px-4 py-2 rounded-lg font-medium"
                    >
                      Save Changes
                    </button>
                    <button 
                      onClick={handleCancel}
                      className="bg-gray-200 px-4 py-2 rounded-lg font-medium"
                    >
                      Cancel
                    </button>
                  </div>
                ) : isCurrentUserProfile ? (
                  <div className="flex space-x-2">
                    <button 
                      onClick={handleEdit}
                      className="btn-primary px-4 py-2 rounded-lg font-medium"
                    >
                      Edit Profile
                    </button>
                    <button 
                      onClick={onLogout}
                      className="btn-tertiary px-4 py-2 rounded-lg font-medium"
                    >
                      Logout
                    </button>
                  </div>
                ) : (
                  <div className="flex space-x-2">
                    {!currentUser.friends.includes(user.id) && (
                      <button 
                        onClick={() => onSendRequest(user.id)}
                        className="btn-primary px-4 py-2 rounded-lg font-medium"
                      >
                        Add Friend
                      </button>
                    )}
                    <button 
                      onClick={() => onStartChat(user.id)}
                      className="btn-secondary px-4 py-2 rounded-lg font-medium"
                    >
                      <i className="fas fa-comments mr-1"></i> Chat
                    </button>
                    <button 
                      onClick={onBack}
                      className="bg-gray-200 px-4 py-2 rounded-lg font-medium"
                    >
                      Back to Home
                    </button>
                  </div>
                )}
              </div>
            </div>
          </header>

          <div className="max-w-4xl mx-auto">
            <div className="bg-white rounded-xl shadow-lg overflow-hidden mt-4 glass-effect">
              <div className="profile-cover relative">
                <img 
                  src={coverPic} 
                  alt="Cover" 
                  className="w-full h-full object-cover"
                />
                {isCurrentUserProfile && isEditing && (
                  <div className="absolute top-4 right-4">
                    <label className="bg-white p-2 rounded-full shadow-lg cursor-pointer hover:bg-gray-100">
                      <i className="fas fa-camera text-purple-600"></i>
                      <input 
                        type="file" 
                        accept="image/*" 
                        onChange={handleCoverChange}
                        className="hidden"
                      />
                    </label>
                  </div>
                )}
              </div>
              
              <div className="px-6 pb-6 relative">
                <div className="flex flex-col md:flex-row">
                  <div className="relative -mt-16 md:mr-6">
                    <div className="relative">
                      <img 
                        src={profilePic} 
                        alt={user.name} 
                        className="w-32 h-32 rounded-xl border-4 border-white shadow-lg"
                      />
                      {isCurrentUserProfile && isEditing && (
                        <label className="absolute bottom-2 right-2 bg-white p-2 rounded-full shadow cursor-pointer">
                          <i className="fas fa-camera text-purple-600 text-sm"></i>
                          <input 
                            type="file" 
                            accept="image/*" 
                            onChange={handleProfilePicChange}
                            className="hidden"
                            key={fileInputKey + 1}
                          />
                        </label>
                      )}
                    </div>
                  </div>
                  
                  <div className="flex-1 mt-4 md:mt-0">
                    {isCurrentUserProfile && isEditing ? (
                      <>
                        <input
                          name="name"
                          value={editedUser.name}
                          onChange={handleChange}
                          className="text-2xl font-bold mb-2 border rounded-lg p-2 w-full"
                        />
                        <textarea
                          name="bio"
                          value={editedUser.bio}
                          onChange={handleChange}
                          className="text-gray-600 border rounded-lg p-2 w-full"
                          rows="2"
                          placeholder="Write your bio..."
                        />
                      </>
                    ) : (
                      <>
                        <h1 className="text-2xl font-bold">{user.name}</h1>
                        <p className="text-gray-600 mb-4">{user.bio || 'No bio yet'}</p>
                      </>
                    )}
                    
                    <div className="flex flex-wrap gap-3 mt-4">
                      <div className="bg-purple-50 rounded-lg px-4 py-2">
                        <p className="text-xs text-gray-500">Friends</p>
                        <p className="font-medium">{user.friends.length}</p>
                      </div>
                      <div className="bg-purple-50 rounded-lg px-4 py-2">
                        <p className="text-xs text-gray-500">Department</p>
                        <p className="font-medium">{user.department}</p>
                      </div>
                      <div className="bg-purple-50 rounded-lg px-4 py-2">
                        <p className="text-xs text-gray-500">Batch</p>
                        <p className="font-medium">{user.batch}</p>
                      </div>
                      <div className="bg-purple-50 rounded-lg px-4 py-2">
                        <p className="text-xs text-gray-500">Section</p>
                        <p className="font-medium">{user.section}</p>
                      </div>
                    </div>
                  </div>
                </div>
                
                <div className="mt-8">
                  <h2 className="text-xl font-semibold mb-4">About</h2>
  <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
  {isCurrentUserProfile && (
    <>
      <div>
        <p className="text-sm text-gray-500 mb-1">Email</p>
        <p>{user.email}</p>
      </div>
      <div>
        <p className="text-sm text-gray-500 mb-1">University ID</p>
        <p>{user.universityId}</p>
      </div>
      <div>
        <p className="text-xs text-gray-500 mb-1">University Email</p>
        <p>{user.universityEmail}</p>
      </div>
    </>
  )}
  <div>
    <p className="text-xs text-gray-500 mb-1">Joined</p>
    <p>May 2023</p>
  </div>
</div>
                </div>
              </div>
            </div>

            {/* User's Posts */}
            <div className="mt-8">
              <h2 className="text-2xl font-bold mb-6 text-center">{(user?.name || 'User').split(' ')[0]}'s Posts</h2>
              {posts.length === 0 ? (
                <div className="text-center py-10 bg-white rounded-xl shadow glass-effect">
                  <i className="fas fa-feather-alt text-4xl text-gray-300 mb-4"></i>
                  <p className="text-gray-500">No posts yet</p>
                </div>
              ) : (
                <div className="grid grid-cols-1 gap-6">
                  {posts.map(post => (
                    <div key={post.id} className="vibrant-card p-6 fade-in">
                      <div className="flex items-center mb-4">
                        <img 
                          src={user.profilePic} 
                          alt={user.name} 
                          className="w-10 h-10 rounded-full mr-3"
                        />
                        <div>
                          <h3 className="font-semibold">{user.name}</h3>
                          <p className="text-xs text-gray-500">
                            {new Date(post.timestamp).toLocaleDateString()} â€¢ {new Date(post.timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}
                          </p>
                        </div>
                        {isCurrentUserProfile && (
                          <div className="ml-auto">
                            <button 
                              onClick={() => onDeletePost(post.id)}
                              className="text-red-500 hover:text-red-700"
                            >
                              <i className="fas fa-trash"></i>
                            </button>
                          </div>
                        )}
                      </div>
                      
                      <p className="mb-4">{post.content}</p>
                      
                      {post.media && (
                        <div className="mb-4 rounded-lg overflow-hidden">
                          {post.mediaType === 'image' ? (
                            <img 
                              src={post.media} 
                              alt="Post media" 
                              className="w-full max-h-96 object-cover"
                            />
                          ) : (
                            <video controls className="w-full">
                              <source src={post.media} type="video/mp4" />
                            </video>
                          )}
                        </div>
                      )}
                      
                      <div className="flex justify-between text-sm text-gray-500 mb-3">
                        <div className="flex items-center">
                          <i className="fas fa-thumbs-up mr-1 text-blue-500"></i>
                          <span>{post.likes.length} likes</span>
                        </div>
                        <span>
                          {post.comments.length} comments
                        </span>
                      </div>
                      
                      <div className="border-t pt-3">
                        {post.comments.length > 0 && (
                          <div className="space-y-3 mb-3">
                            {post.comments.slice(0, 2).map((comment, index) => {
                              return (
                                <div key={index} className="flex items-start">
                                  <div className="bg-gray-100 p-3 rounded-xl flex-1">
                                    <div className="text-sm">{comment.text}</div>
                                  </div>
                                </div>
                              );
                            })}
                            {post.comments.length > 2 && (
                              <button className="text-purple-600 text-sm">
                                View all {post.comments.length} comments
                              </button>
                            )}
                          </div>
                        )}
                        
                        <div className="flex items-center">
                          <input
                            type="text"
                            placeholder="Write a comment..."
                            className="flex-1 p-2 border rounded-full focus:outline-none"
                          />
                          <button className="text-purple-600 ml-2">
                            <i className="fas fa-paper-plane"></i>
                          </button>
                        </div>
                      </div>
                    </div>
                  ))}
                </div>
              )}
            </div>
          </div>
        </div>
      );
    }
    
    // ======================
    // Clubs Page Component
    // ======================
    function ClubsPage({ onBack, clubs, currentUser, onJoin, onViewClub }) {
      return (
        <div className="min-h-screen bg-gray-50">
          <header className="header-gradient">
            <div className="max-w-6xl mx-auto px-4 py-3 flex justify-between items-center">
              <button onClick={onBack} className="flex items-center text-white font-medium">
                <i className="fas fa-arrow-left mr-2"></i> Back
              </button>
              <h1 className="text-xl font-bold text-white">Campus Clubs</h1>
              <div></div>
            </div>
          </header>

          <div className="max-w-4xl mx-auto p-4">
            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
              {clubs.map(club => (
                <div key={club.id} className="club-card vibrant-card">
                  <div className="h-48 bg-gradient-to-r from-blue-500 to-purple-600 relative">
                    <div className="absolute bottom-4 left-4">
                      <h2 className="text-xl font-bold text-white">{club.name}</h2>
                      <p className="text-white text-opacity-80">{club.members.length} members</p>
                    </div>
                  </div>
                  <div className="p-5">
                    <p className="text-gray-600 mb-4">{club.description}</p>
                    
                    <div className="flex justify-between items-center mb-4">
                      {club.members.some(m => m.id === currentUser.id) ? (
                        <span className="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm">
                          <i className="fas fa-check-circle mr-1"></i> Joined
                        </span>
                      ) : (
                        <button
                          onClick={() => onJoin(club.id)}
                          className="btn-primary px-4 py-2 rounded-lg text-sm"
                        >
                          Join Club
                        </button>
                      )}
                      
                      <button 
                        onClick={() => onViewClub(club.id)}
                        className="text-purple-600 font-medium text-sm"
                      >
                        View Activities
                      </button>
                    </div>
                    
                    <div className="mt-4">
                      <h3 className="font-medium mb-2">Recent Members</h3>
                      <div className="flex -space-x-2">
                        {club.members.slice(0, 5).map(member => (
                          <img 
                            key={member.id}
                            src={member.profilePic} 
                            alt={member.name}
                            className="w-10 h-10 rounded-full border-2 border-white"
                            title={member.name}
                          />
                        ))}
                        {club.members.length > 5 && (
                          <div className="w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center text-xs">
                            +{club.members.length - 5}
                          </div>
                        )}
                      </div>
                    </div>
                  </div>
                </div>
              ))}
            </div>
          </div>
        </div>
      );
    }

    // ======================
    // Club Details Page Component
    // ======================
    function ClubDetailsPage({ club, onBack, posts, currentUser }) {
      return (
        <div className="min-h-screen bg-gray-50">
          <header className="header-gradient">
            <div className="max-w-6xl mx-auto px-4 py-3 flex justify-between items-center">
              <button onClick={onBack} className="flex items-center text-white font-medium">
                <i className="fas fa-arrow-left mr-2"></i> Back
              </button>
              <h1 className="text-xl font-bold text-white">{club.name}</h1>
              <div></div>
            </div>
          </header>

          <div className="max-w-4xl mx-auto p-4">
            <div className="club-card vibrant-card p-6 mb-6">
              <div className="flex flex-col md:flex-row items-center">
                <div className="bg-gradient-to-r from-blue-500 to-purple-600 w-full md:w-1/3 h-48 rounded-lg mb-4 md:mb-0 md:mr-6 flex items-center justify-center">
                  <i className="fas fa-users text-6xl text-white"></i>
                </div>
                <div className="flex-1">
                  <h2 className="text-2xl font-bold mb-3">{club.name}</h2>
                  <p className="text-gray-600 mb-4">{club.description}</p>
                  <div className="flex items-center">
                    <div className="bg-purple-100 p-3 rounded-lg mr-4">
                      <i className="fas fa-users text-purple-600"></i>
                    </div>
                    <div>
                      <p className="font-medium">{club.members.length} Members</p>
                      <p className="text-sm text-gray-500">Organized by John Doe</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <h2 className="text-xl font-bold mb-4">Club Activities</h2>
            <div className="space-y-6">
              {posts.length > 0 ? posts.map(post => (
                <div key={post.id} className="vibrant-card p-6 fade-in">
                  <div className="flex items-center mb-4">
                    <img 
                      src={post.user.profilePic} 
                      alt={post.user.name} 
                      className="w-10 h-10 rounded-full mr-3"
                    />
                    <div>
                      <h3 className="font-semibold">{post.user.name}</h3>
                      <p className="text-xs text-gray-500">
                        {new Date(post.timestamp).toLocaleDateString()} â€¢ {new Date(post.timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}
                      </p>
                    </div>
                  </div>
                  
                  <p className="mb-4">{post.content}</p>
                  
                  {post.media && (
                    <div className="mb-4 rounded-lg overflow-hidden">
                      {post.mediaType === 'image' ? (
                        <img 
                          src={post.media} 
                          alt="Post media" 
                          className="w-full max-h-96 object-cover"
                        />
                      ) : (
                        <video controls className="w-full">
                          <source src={post.media} type="video/mp4" />
                        </video>
                      )}
                    </div>
                  )}
                  
                  <div className="flex justify-between text-sm text-gray-500 mb-3">
                    <div className="flex items-center">
                      <i className="fas fa-thumbs-up mr-1 text-blue-500"></i>
                      <span>{post.likes.length} likes</span>
                    </div>
                    <span>
                      {post.comments.length} comments
                    </span>
                  </div>
                </div>
              )) : (
                <div className="text-center py-10 vibrant-card">
                  <i className="fas fa-feather-alt text-4xl text-gray-300 mb-4"></i>
                  <p className="text-gray-500">No activities yet</p>
                </div>
              )}
            </div>
          </div>
        </div>
      );
    }

    // ======================
    // Sports Page Component
    // ======================
    function SportsPage({ onBack, tournaments, posts, currentUser, users, onRegister, onCreate }) {
      const [activeTab, setActiveTab] = React.useState('tournaments');
      const [showCreateForm, setShowCreateForm] = React.useState(false);
      const [newTournament, setNewTournament] = React.useState({
        title: '',
        description: '',
        date: '',
        location: '',
        sport: 'Basketball'
      });
      
      const handleChange = (e) => {
        setNewTournament({
          ...newTournament,
          [e.target.name]: e.target.value
        });
      };
      
      const handleSubmit = (e) => {
        e.preventDefault();
        onCreate(newTournament);
        setShowCreateForm(false);
        setNewTournament({
          title: '',
          description: '',
          date: '',
          location: '',
          sport: 'Basketball'
        });
      };
      
      return (
        <div className="min-h-screen bg-gray-50">
          <header className="header-gradient">
            <div className="max-w-6xl mx-auto px-4 py-3 flex justify-between items-center">
              <button onClick={onBack} className="flex items-center text-white font-medium">
                <i className="fas fa-arrow-left mr-2"></i> Back
              </button>
              <h1 className="text-xl font-bold text-white">Sports Activities</h1>
              <div></div>
            </div>
          </header>

          <div className="max-w-4xl mx-auto p-4">
            <div className="flex mb-6 border-b">
              <button 
                className={`px-4 py-2 font-medium ${activeTab === 'tournaments' ? 'border-b-2 border-purple-600' : ''}`}
                onClick={() => setActiveTab('tournaments')}
              >
                Tournaments
              </button>
              <button 
                className={`px-4 py-2 font-medium ${activeTab === 'posts' ? 'border-b-2 border-purple-600' : ''}`}
                onClick={() => setActiveTab('posts')}
              >
                Sports Posts
              </button>
              <button 
                className={`px-4 py-2 font-medium ${activeTab === 'facilities' ? 'border-b-2 border-purple-600' : ''}`}
                onClick={() => setActiveTab('facilities')}
              >
                Facilities
              </button>
            </div>
            
            {activeTab === 'tournaments' && (
              <div>
                <div className="flex justify-between items-center mb-6">
                  <h2 className="text-xl font-bold">Upcoming Tournaments</h2>
                  <button 
                    onClick={() => setShowCreateForm(!showCreateForm)}
                    className="btn-primary px-4 py-2 rounded-lg"
                  >
                    {showCreateForm ? 'Cancel' : 'Create Tournament'}
                  </button>
                </div>
                
                {showCreateForm && (
                  <div className="sports-card vibrant-card p-6 mb-6 fade-in">
                    <h3 className="text-lg font-bold mb-4">Create New Tournament</h3>
                    <form onSubmit={handleSubmit} className="space-y-4">
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-1">Title</label>
                        <input
                          name="title"
                          value={newTournament.title}
                          onChange={handleChange}
                          className="w-full p-3 border rounded-lg"
                          required
                        />
                      </div>
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-1">Description</label>
                        <textarea
                          name="description"
                          value={newTournament.description}
                          onChange={handleChange}
                          className="w-full p-3 border rounded-lg"
                          rows="3"
                          required
                        ></textarea>
                      </div>
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-1">Sport</label>
                          <select
                            name="sport"
                            value={newTournament.sport}
                            onChange={handleChange}
                            className="w-full p-3 border rounded-lg"
                            required
                          >
                            <option value="Basketball">Basketball</option>
                            <option value="Football">Football</option>
                            <option value="Cricket">Cricket</option>
                            <option value="Tennis">Tennis</option>
                            <option value="Volleyball">Volleyball</option>
                          </select>
                        </div>
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-1">Date</label>
                          <input
                            type="date"
                            name="date"
                            value={newTournament.date}
                            onChange={handleChange}
                            className="w-full p-3 border rounded-lg"
                            required
                          />
                        </div>
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-1">Location</label>
                          <input
                            name="location"
                            value={newTournament.location}
                            onChange={handleChange}
                            className="w-full p-3 border rounded-lg"
                            required
                          />
                        </div>
                      </div>
                      <button type="submit" className="btn-primary w-full py-3 rounded-lg">
                        Create Tournament
                      </button>
                    </form>
                  </div>
                )}
                
                <div className="grid grid-cols-1 gap-6">
                  {tournaments.map(tournament => {
                    const organizer = users.find(u => u.id === tournament.organizerId);
                    return (
                      <div key={tournament.id} className="tournament-card vibrant-card p-6">
                        <div className="flex items-start">
                          <div className="sports-icon">
                            <i className="fas fa-trophy"></i>
                          </div>
                          
                          <div className="flex-1 ml-4">
                            <h3 className="text-xl font-bold mb-2">{tournament.title}</h3>
                            <p className="text-gray-600 mb-4">{tournament.description}</p>
                            
                            <div className="grid grid-cols-2 gap-4 mb-4">
                              <div>
                                <p className="text-sm text-gray-500 mb-1">Sport</p>
                                <p className="font-medium">{tournament.sport}</p>
                              </div>
                              <div>
                                <p className="text-sm text-gray-500 mb-1">Date</p>
                                <p className="font-medium">
                                  {new Date(tournament.date).toLocaleDateString()}
                                </p>
                              </div>
                              <div>
                                <p className="text-sm text-gray-500 mb-1">Location</p>
                                <p className="font-medium">{tournament.location}</p>
                              </div>
                              <div>
                                <p className="text-sm text-gray-500 mb-1">Organizer</p>
                                <p className="font-medium">{organizer ? organizer.name : 'Unknown'}</p>
                              </div>
                            </div>
                            
                            <div className="flex items-center justify-between">
                              <div>
                                <p className="text-sm text-gray-500 mb-1">Participants</p>
                                <div className="flex -space-x-2">
                                  {tournament.participants.slice(0, 5).map(participantId => {
                                    const participant = users.find(u => u.id === participantId);
                                    return participant ? (
                                      <img 
                                        key={participantId}
                                        src={participant.profilePic} 
                                        alt={participant.name}
                                        className="w-8 h-8 rounded-full border-2 border-white"
                                        title={participant.name}
                                      />
                                    ) : null;
                                  })}
                                  {tournament.participants.length > 5 && (
                                    <div className="w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center text-xs font-medium">
                                      +{tournament.participants.length - 5}
                                    </div>
                                  )}
                                </div>
                              </div>
                              
                              {!tournament.participants.includes(currentUser.id) && (
                                <button 
                                  onClick={() => onRegister(tournament.id)}
                                  className="btn-primary px-4 py-2 rounded-lg flex items-center"
                                >
                                  <i className="fas fa-sign-in-alt mr-2"></i> 
                                  Join Event
                                </button>
                              )}
                              {tournament.participants.includes(currentUser.id) && (
                                <span className="bg-green-100 text-green-800 px-3 py-2 rounded-lg">
                                  <i className="fas fa-check mr-1"></i> Registered
                                </span>
                              )}
                            </div>
                          </div>
                        </div>
                      </div>
                    );
                  })}
                </div>
              </div>
            )}
            
            {activeTab === 'posts' && (
              <div className="space-y-6">
                {posts.length > 0 ? posts.map(post => {
                  const postUser = users.find(u => u.id === post.userId);
                  return (
                    <div key={post.id} className="vibrant-card p-6 fade-in">
                      <div className="flex items-center mb-4">
                        <img 
                          src={postUser ? postUser.profilePic : 'https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_1280.png'} 
                          alt={postUser ? postUser.name : 'Unknown User'} 
                          className="w-10 h-10 rounded-full mr-3"
                        />
                        <div>
                          <h3 className="font-semibold">{postUser ? postUser.name : 'Unknown User'}</h3>
                          <p className="text-xs text-gray-500">
                            {new Date(post.timestamp).toLocaleDateString()} â€¢ {new Date(post.timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}
                          </p>
                        </div>
                      </div>
                      
                      <p className="mb-4">{post.content}</p>
                      
                      {post.media && (
                        <div className="mb-4 rounded-lg overflow-hidden">
                          {post.mediaType === 'image' ? (
                            <img 
                              src={post.media} 
                              alt="Post media" 
                              className="w-full max-h-96 object-cover"
                            />
                          ) : (
                            <video controls className="w-full">
                              <source src={post.media} type="video/mp4" />
                            </video>
                          )}
                        </div>
                      )}
                      
                      <div className="flex justify-between text-sm text-gray-500 mb-3">
                        <div className="flex items-center">
                          <i className="fas fa-thumbs-up mr-1 text-blue-500"></i>
                          <span>{post.likes.length} likes</span>
                        </div>
                        <span>
                          {post.comments.length} comments
                        </span>
                      </div>
                    </div>
                  );
                }) : (
                  <div className="text-center py-10 vibrant-card">
                    <i className="fas fa-baseball-ball text-4xl text-gray-300 mb-4"></i>
                    <p className="text-gray-500">No sports posts yet</p>
                  </div>
                )}
              </div>
            )}
            
            {activeTab === 'facilities' && (
              <div className="vibrant-card p-6">
                <h2 className="text-xl font-semibold mb-4">Sports Facilities</h2>
                <div className="space-y-4">
                  <div className="flex items-center p-3 border rounded-lg">
                    <div className="bg-purple-100 p-3 rounded-lg mr-4">
                      <i className="fas fa-swimming-pool text-purple-600 text-xl"></i>
                    </div>
                    <div>
                      <h3 className="font-medium">Swimming Pool</h3>
                      <p className="text-sm text-gray-500">Open: 6AM - 8PM</p>
                    </div>
                  </div>
                  <div className="flex items-center p-3 border rounded-lg">
                    <div className="bg-purple-100 p-3 rounded-lg mr-4">
                      <i className="fas fa-basketball-ball text-purple-600 text-xl"></i>
                    </div>
                    <div>
                      <h3 className="font-medium">Basketball Court</h3>
                      <p className="text-sm text-gray-500">Open: 5AM - 10PM</p>
                    </div>
                  </div>
                  <div className="flex items-center p-3 border rounded-lg">
                    <div className="bg-purple-100 p-3 rounded-lg mr-4">
                      <i className="fas fa-running text-purple-600 text-xl"></i>
                    </div>
                    <div>
                      <h3 className="font-medium">Athletics Track</h3>
                      <p className="text-sm text-gray-500">Open: 24 hours</p>
                    </div>
                  </div>
                  <div className="flex items-center p-3 border rounded-lg">
                    <div className="bg-purple-100 p-3 rounded-lg mr-4">
                      <i className="fas fa-table-tennis text-purple-600 text-xl"></i>
                    </div>
                    <div>
                      <h3 className="font-medium">Table Tennis</h3>
                      <p className="text-sm text-gray-500">Open: 8AM - 10PM</p>
                    </div>
                  </div>
                  <div className="flex items-center p-3 border rounded-lg">
                    <div className="bg-purple-100 p-3 rounded-lg mr-4">
                      <i className="fas fa-volleyball-ball text-purple-600 text-xl"></i>
                    </div>
                    <div>
                      <h3 className="font-medium">Volleyball Court</h3>
                      <p className="text-sm text-gray-500">Open: 7AM - 9PM</p>
                    </div>
                  </div>
                </div>
              </div>
            )}
          </div>
        </div>
      );
    }

    // ======================
    // Blood Donors Page Component
    // ======================
    function BloodDonorsPage({ onBack, users, currentUser, onRegister, onContact }) {
      const [bloodGroup, setBloodGroup] = React.useState('');
      const [donors, setDonors] = React.useState([]);
      const [showRegister, setShowRegister] = React.useState(false);
      const [selectedGroup, setSelectedGroup] = React.useState('');
      
      const searchDonors = () => {
        const filtered = users.filter(
          u => u.bloodGroup && u.bloodGroup.includes(bloodGroup.toUpperCase())
        );
        setDonors(filtered);
      };
      
      const handleRegister = () => {
        if (selectedGroup) {
          onRegister(selectedGroup);
          setShowRegister(false);
          alert(`Thank you for registering as a ${selectedGroup} blood donor!`);
        }
      };
      
      return (
        <div className="min-h-screen bg-gray-50">
          <header className="header-gradient">
            <div className="max-w-6xl mx-auto px-4 py-3 flex justify-between items-center">
              <button onClick={onBack} className="flex items-center text-white font-medium">
                <i className="fas fa-arrow-left mr-2"></i> Back
              </button>
              <h1 className="text-xl font-bold text-white">Blood Donation</h1>
              <div></div>
            </div>
          </header>

          <div className="max-w-4xl mx-auto p-4">
            <div className="blood-card vibrant-card p-6 mb-6">
              <div className="flex flex-col md:flex-row items-center">
                <div className="flex-1 text-center md:text-left mb-4 md:mb-0">
                  <h2 className="text-2xl font-bold mb-2">Blood Donation Camp</h2>
                  <p className="mb-4">Join our blood donation drive and help save lives!</p>
                  <button 
                    onClick={() => setShowRegister(true)}
                    className="btn-tertiary px-6 py-3 rounded-lg font-bold"
                  >
                    Register as Donor
                  </button>
                </div>
                <div className="text-center">
                  <i className="fas fa-heartbeat text-6xl text-red-500 opacity-50"></i>
                </div>
              </div>
            </div>
            
            {showRegister && (
              <div className="vibrant-card p-6 mb-6 fade-in">
                <h3 className="text-lg font-bold mb-4">Register as Blood Donor</h3>
                <div className="mb-4">
                  <p className="mb-2">Select your blood group:</p>
                  <div className="grid grid-cols-4 gap-2">
                    {['A+', 'A-', 'B+', 'B-', 'AB+', 'AB-', 'O+', 'O-'].map(group => (
                      <button
                        key={group}
                        className={`p-3 rounded-lg border ${selectedGroup === group ? 'bg-red-100 border-red-500' : 'bg-gray-100'}`}
                        onClick={() => setSelectedGroup(group)}
                      >
                        {group}
                      </button>
                    ))}
                  </div>
                </div>
                <div className="flex space-x-2">
                  <button 
                    onClick={() => setShowRegister(false)}
                    className="bg-gray-200 px-4 py-2 rounded-lg flex-1"
                  >
                    Cancel
                  </button>
                  <button 
                    onClick={handleRegister}
                    disabled={!selectedGroup}
                    className="btn-tertiary px-4 py-2 rounded-lg flex-1 disabled:opacity-50"
                  >
                    Register
                  </button>
                </div>
              </div>
            )}
            
            <div className="blood-card vibrant-card p-6 mb-6">
              <h3 className="font-bold text-lg mb-4">Find Blood Donors</h3>
              <div className="flex flex-col md:flex-row gap-4 mb-6">
                <select
                  value={bloodGroup}
                  onChange={e => setBloodGroup(e.target.value)}
                  className="flex-1 p-3 border rounded-lg"
                >
                  <option value="">Select Blood Group</option>
                  <option value="A+">A+</option>
                  <option value="A-">A-</option>
                  <option value="B+">B+</option>
                  <option value="B-">B-</option>
                  <option value="AB+">AB+</option>
                  <option value="AB-">AB-</option>
                  <option value="O+">O+</option>
                  <option value="O-">O-</option>
                </select>
                <button 
                  onClick={searchDonors}
                  className="btn-tertiary px-6 py-3 rounded-lg font-medium"
                >
                  Search Donors
                </button>
              </div>
              
              <div className="overflow-x-auto">
                <table className="w-full">
                  <thead>
                    <tr className="bg-red-50">
                      <th className="p-3 text-left">Donor</th>
                      <th className="p-3 text-left">Blood Group</th>
                      <th className="p-3 text-left">Last Donation</th>
                      <th className="p-3 text-left">Status</th>
                      <th className="p-3 text-left">Action</th>
                    </tr>
                  </thead>
                  <tbody>
                    {donors.map(donor => (
                      <tr key={donor.id} className="border-b hover:bg-red-50/50">
                        <td className="p-3">
                          <div className="flex items-center">
                            <img 
                              src={donor.profilePic} 
                              alt={donor.name} 
                              className="w-10 h-10 rounded-full mr-3" 
                            />
                            <div>
                              <div className="font-medium">{donor.name}</div>
                              <div className="text-xs text-gray-500">{donor.department}</div>
                            </div>
                          </div>
                        </td>
                        <td className="p-3">
                          <span className="bg-red-100 text-red-800 px-3 py-1 rounded-full font-bold">
                            {donor.bloodGroup}
                          </span>
                        </td>
                        <td className="p-3">
                          <span className="text-sm">3 months ago</span>
                        </td>
                        <td className="p-3">
                          <span className="bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs">
                            <i className="fas fa-check-circle mr-1"></i> Available
                          </span>
                        </td>
                        <td className="p-3">
                          <button 
                            onClick={() => onContact(donor.id)}
                            className="btn-tertiary px-3 py-1 rounded-lg text-sm flex items-center"
                          >
                            <i className="fas fa-comment-medical mr-1"></i> Request
                          </button>
                        </td>
                      </tr>
                    ))}
                  </tbody>
                </table>
                {donors.length === 0 && (
                  <div className="p-6 text-center text-gray-500">
                    {bloodGroup ? `No ${bloodGroup} donors found` : 'Select a blood group to search'}
                  </div>
                )}
              </div>
            </div>
            
            <div className="vibrant-card p-6">
              <h2 className="font-bold text-lg mb-3">Blood Donation Guidelines</h2>
              <ul className="space-y-2">
                <li className="flex items-start">
                  <i className="fas fa-check-circle text-green-500 mt-1 mr-2"></i>
                  <span>Age between 18-65 years</span>
                </li>
                <li className="flex items-start">
                  <i className="fas fa-check-circle text-green-500 mt-1 mr-2"></i>
                  <span>Weight at least 50 kg</span>
                </li>
                <li className="flex items-start">
                  <i className="fas fa-check-circle text-green-500 mt-1 mr-2"></i>
                  <span>No illnesses in the past 1 month</span>
                </li>
                <li className="flex items-start">
                  <i className="fas fa-check-circle text-green-500 mt-1 mr-2"></i>
                  <span>Not pregnant or breastfeeding</span>
                </li>
                <li className="flex items-start">
                  <i className="fas fa-check-circle text-green-500 mt-1 mr-2"></i>
                  <span>No tattoos or piercings in the last 6 months</span>
                </li>
              </ul>
            </div>
          </div>
        </div>
      );
    }

    // ======================
    // Chat Page Component
    // ======================
  function ChatPage({ 
      user, 
      currentUser, 
      messages, 
      newMessage, 
      isTyping, 
      onBack, 
      onMessageChange, 
      onSend,
      onTyping 
    }) {
      const messagesEndRef = React.useRef(null);
      
      React.useEffect(() => {
        messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
      }, [messages, isTyping]);

      const handleKeyPress = (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          onSend();
        }
      };
      
      const handleInputChange = (e) => {
        onMessageChange(e.target.value);
        // Notify other user when typing starts/stops
        if (e.target.value.length === 1) {
          onTyping(true);
        } else if (e.target.value.length === 0) {
          onTyping(false);
        }
      };

      return (
        <div className="min-h-screen bg-gray-50">
          <header className="chat-header">
            <div className="max-w-6xl mx-auto px-4 py-3 flex items-center">
              <button 
                onClick={onBack} 
                className="flex items-center text-white mr-4 hover:text-gray-200"
              >
                <i className="fas fa-arrow-left"></i>
              </button>
              <div className="flex items-center">
                <div className="relative">
                  <img 
                    src={user.profilePic} 
                    alt={user.name} 
                    className="w-10 h-10 rounded-full mr-3" 
                  />
                  <span className="online-dot"></span>
                </div>
                <div>
                  <h1 className="text-lg font-bold">{user.name}</h1>
                  <p className="text-xs text-white text-opacity-80">
                    {isTyping ? 'Typing...' : 'Online'}
                  </p>
                </div>
              </div>
            </div>
          </header>

          <div className="max-w-2xl mx-auto p-4">
            <div className="bg-white rounded-xl shadow-lg overflow-hidden">
              <div className="h-96 overflow-y-auto p-4 bg-gray-50 flex flex-col">
                {messages.map((message, index) => (
                  <div 
                    key={index} 
                    className={`flex mb-3 ${message.sender.id === currentUser.id ? 'justify-end' : 'justify-start'}`}
                  >
                    <div 
                      className={`message-bubble ${message.sender.id === currentUser.id ? 'sent' : 'received'}`}
                    >
                      {message.content}
                      <div className="chat-timestamp">
                        {new Date(message.timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}
                      </div>
                    </div>
                  </div>
                ))}
                
                {isTyping && (
                  <div className="flex mb-3 justify-start">
                    <div className="message-bubble received">
                      <div className="typing-indicator">
                        <span></span>
                        <span></span>
                        <span></span>
                      </div>
                    </div>
                  </div>
                )}
                <div ref={messagesEndRef} />
              </div>
              
              <div className="p-4 border-t flex items-center bg-white">
                <input
                  type="text"
                  value={newMessage}
                  onChange={handleInputChange}
                  onKeyPress={handleKeyPress}
                  className="flex-1 p-3 border rounded-full focus:outline-none focus:ring-2 focus:ring-purple-500"
                  placeholder="Type a message..."
                />
                <button 
                  onClick={onSend}
                  disabled={!newMessage.trim()}
                  className="ml-3 bg-purple-600 text-white p-3 rounded-full w-12 h-12 flex items-center justify-center disabled:opacity-50 hover:bg-purple-700"
                >
                  <i className="fas fa-paper-plane"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
      );
    }

    // ======================
    // Notifications Page Component
    // ======================
    function NotificationsPage({ 
      onBack, 
      notifications, 
      users, 
      onAcceptRequest, 
      onViewProfile 
    }) {
      // Filter unread notifications
      const unreadNotifications = notifications.filter(n => !n.read);
      const readNotifications = notifications.filter(n => n.read);
      
      return (
        <div className="min-h-screen bg-gray-50">
          <header className="header-gradient">
            <div className="max-w-6xl mx-auto px-4 py-3 flex justify-between items-center">
              <button onClick={onBack} className="flex items-center text-white font-medium">
                <i className="fas fa-arrow-left mr-2"></i> Back
              </button>
              <h1 className="text-xl font-bold text-white">Notifications</h1>
              <div></div>
            </div>
          </header>
          
          <div className="max-w-2xl mx-auto p-4">
            <div className="mb-6">
              <h2 className="text-xl font-bold mb-4 flex items-center">
                <i className="fas fa-bell mr-2 text-purple-600"></i>
                New Notifications
                {unreadNotifications.length > 0 && (
                  <span className="ml-2 bg-red-500 text-white rounded-full px-2 py-1 text-xs">
                    {unreadNotifications.length}
                  </span>
                )}
              </h2>
              
              {unreadNotifications.length > 0 ? (
                <div className="space-y-3">
                  {unreadNotifications.map(notification => {
                    const fromUser = users.find(u => u.id === notification.fromUserId);
                    return (
                      <div key={notification.id} className="notification-card vibrant-card p-4 fade-in">
                        <div className="flex items-start">
                          <img 
                            src={fromUser?.profilePic} 
                            className="w-12 h-12 rounded-full mr-3" 
                          />
                          <div className="flex-1">
                            <p className="mb-2">{notification.message}</p>
                            <p className="text-xs text-gray-500">
                              {new Date(notification.timestamp).toLocaleString()}
                            </p>
                            
                            {notification.type === 'friend_request' && (
                              <div className="mt-3 flex space-x-2">
                                <button 
                                  onClick={() => onAcceptRequest(notification.id, notification.fromUserId)}
                                  className="btn-primary px-3 py-1 rounded text-sm"
                                >
                                  Accept
                                </button>
                                <button className="bg-gray-200 px-3 py-1 rounded text-sm">
                                  Decline
                                </button>
                              </div>
                            )}
                            
                            {notification.type === 'like' && (
                              <button 
                                onClick={() => onViewProfile(notification.fromUserId)}
                                className="text-purple-600 text-sm mt-2"
                              >
                                View Post
                              </button>
                            )}
                          </div>
                        </div>
                      </div>
                    );
                  })}
                </div>
              ) : (
                <div className="text-center py-10 vibrant-card">
                  <i className="fas fa-bell-slash text-4xl text-gray-300 mb-4"></i>
                  <p className="text-gray-500">No new notifications</p>
                </div>
              )}
            </div>
            
            <div>
              <h2 className="text-xl font-bold mb-4 flex items-center">
                <i className="fas fa-history mr-2 text-gray-500"></i>
                Earlier Notifications
              </h2>
              
              {readNotifications.length > 0 ? (
                <div className="space-y-3">
                  {readNotifications.map(notification => {
                    const fromUser = users.find(u => u.id === notification.fromUserId);
                    return (
                      <div key={notification.id} className="bg-white p-4 rounded-xl">
                        <div className="flex items-start">
                          <img 
                            src={fromUser?.profilePic} 
                            className="w-10 h-10 rounded-full mr-3 opacity-70" 
                          />
                          <div>
                            <p className="mb-1">{notification.message}</p>
                            <p className="text-xs text-gray-500">
                              {new Date(notification.timestamp).toLocaleString()}
                            </p>
                          </div>
                        </div>
                      </div>
                    );
                  })}
                </div>
              ) : (
                <div className="text-center py-5 text-gray-500">
                  No earlier notifications
                </div>
              )}
            </div>
          </div>
        </div>
      );
    }
    
    // ======================
    // Search Page Component (Simplified)
    // ======================
    function SearchPage({ onBack, posts, users, currentUser, onSendRequest, onLikePost, onAddComment, onDeletePost, onViewProfile, onStartChat }) {
      return (
        <div className="min-h-screen bg-gray-50">
          <header className="header-gradient">
            <div className="max-w-6xl mx-auto px-4 py-3 flex justify-between items-center">
              <button onClick={onBack} className="flex items-center text-white font-medium">
                <i className="fas fa-arrow-left mr-2"></i> Back
              </button>
              <h1 className="text-xl font-bold text-white">Search Results</h1>
              <div></div>
            </div>
          </header>

          <div className="max-w-4xl mx-auto p-4">
            <h2 className="text-xl font-bold mb-4">Users</h2>
            <div className="grid grid-cols-1 gap-4 mb-8">
              {users.length > 0 ? users.map(user => (
                <div key={user.id} className="vibrant-card p-4 flex items-center justify-between">
                  <div className="flex items-center">
                    <img 
                      src={user.profilePic} 
                      alt={user.name} 
                      className="w-12 h-12 rounded-full mr-4"
                    />
                    <div>
                      <h3 className="font-semibold">{user.name}</h3>
                      <p className="text-sm text-gray-500">{user.department}</p>
                    </div>
                  </div>
                  <div className="flex space-x-2">
                    <button 
                      onClick={() => onViewProfile(user.id)}
                      className="btn-primary px-3 py-1 rounded-lg text-sm"
                    >
                      View Profile
                    </button>
                    {!currentUser.friends.includes(user.id) && (
                      <button 
                        onClick={() => onSendRequest(user.id)}
                        className="btn-secondary px-3 py-1 rounded-lg text-sm"
                      >
                        Add Friend
                      </button>
                    )}
                    <button 
                      onClick={() => onStartChat(user.id)}
                      className="chat-btn px-3 py-1 text-sm flex items-center"
                    >
                      <i className="fas fa-comment mr-1"></i> Chat
                    </button>
                  </div>
                </div>
              )) : (
                <div className="text-center py-6 text-gray-500">
                  No users found
                </div>
              )}
            </div>
            
            <h2 className="text-xl font-bold mb-4">Posts</h2>
            <div className="space-y-4">
              {posts.length > 0 ? posts.map(post => {
                const postUser = users.find(u => u.id === post.userId) || {
                  id: 0,
                  name: 'Unknown User',
                  profilePic: 'https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_1280.png'
                };
                return (
                  <div key={post.id} className="vibrant-card p-4">
                    <div className="flex items-center mb-3">
                      <img 
                        src={postUser.profilePic} 
                        alt={postUser.name} 
                        className="w-10 h-10 rounded-full mr-3"
                      />
                      <div>
                        <h3 className="font-semibold">{postUser.name}</h3>
                        <p className="text-xs text-gray-500">
                          {new Date(post.timestamp).toLocaleDateString()}
                        </p>
                      </div>
                    </div>
                    <p className="mb-3">{post.content}</p>
                    <div className="flex space-x-4">
                      <button 
                        onClick={() => onLikePost(post.id)}
                        className="text-gray-600"
                      >
                        <i className="fas fa-thumbs-up mr-1"></i> Like
                      </button>
                      <button 
                        onClick={() => onViewProfile(postUser.id)}
                        className="text-gray-600"
                      >
                        <i className="fas fa-user mr-1"></i> View Profile
                      </button>
                      <button 
                        onClick={() => onStartChat(postUser.id)}
                        className="chat-btn flex items-center"
                      >
                        <i className="fas fa-comment mr-1"></i> Chat
                      </button>
                    </div>
                  </div>
                );
              }) : (
                <div className="text-center py-6 text-gray-500">
                  No posts found
                </div>
              )}
            </div>
          </div>
        </div>
      );
    }
    
    // ======================
    // Render the app
    // ======================
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
